const E=function(e,n,l,t){if(!e)return;l=l||{};let r=l.id||T();if(e.entities.getById(r))return;let c=l.color||Cesium.Color.RED,f=l.outlineColor||c.withAlpha(1),a=l.outlineWidth||2;const o=new Cesium.ScreenSpaceEventHandler(e.canvas);let i=[],s,h=!0;o.setInputAction(function(u){let d=u.position,C=m(e,d);if(i.length==0){i.push(C);let g=new Cesium.CallbackProperty(function(){return i.concat([i[0]])},!1),y=new Cesium.CallbackProperty(function(){return new Cesium.PolygonHierarchy(i)},!1);s=e.entities.add({name:"Polygon",id:r,polyline:{positions:g,width:a,material:f,clampToGround:!0},polygon:{heightReference:Cesium.HeightReference.None,hierarchy:y,material:c}}),s.GeoType="Polygon"}i.push(C)},Cesium.ScreenSpaceEventType.LEFT_CLICK),o.setInputAction(function(u){let d=u.endPosition;if(Cesium.defined(s)){i.pop();let C=m(e,d);i.push(C)}i.length===3&&(s.polygon.heightReference=Cesium.HeightReference.CLAMP_TO_GROUND)},Cesium.ScreenSpaceEventType.MOUSE_MOVE),o.setInputAction(function(u){i.pop(),s.pottingPoint=i,n.push(s),o.destroy(),h=!1,typeof t=="function"&&t(s)},Cesium.ScreenSpaceEventType.RIGHT_DOWN),document.onkeydown=function(u){if(u.ctrlKey&&window.event.keyCode==90){if(!h)return!1;i.pop(),i.length==2}}};function m(e,n){let l=e.scene.drillPick(n),t=null,r=!1,c=!1;for(let a in l){let o=l[a];if((o&&o.primitive instanceof Cesium.Cesium3DTileFeature||o&&o.primitive instanceof Cesium.Cesium3DTileset||o&&o.primitive instanceof Cesium.Model)&&(r=!0),r&&(e.scene.pick(n),t=e.scene.pickPosition(n),t)){let i=Cesium.Cartographic.fromCartesian(t);i.height<0&&(i.height=0);let s=Cesium.Math.toDegrees(i.longitude),h=Cesium.Math.toDegrees(i.latitude),u=i.height;t=p(e,{lng:s,lat:h,alt:u})}}let f=e.terrainProvider instanceof Cesium.EllipsoidTerrainProvider;if(!r&&!f){let a=e.scene.camera.getPickRay(n);if(!a)return null;t=e.scene.globe.pick(a,e.scene),c=!0}if(!r&&!c&&f&&(t=e.scene.camera.pickEllipsoid(n,e.scene.globe.ellipsoid)),t){let a=P(e,t);return a.alt<0&&(t=p(e,a,.1)),t}return!1}function p(e,n,l){return n?Cesium.Cartesian3.fromDegrees(n.lng||n.lon,n.lat,n.alt=l||n.alt,Cesium.Ellipsoid.WGS84):Cesium.Cartesian3.ZERO}function P(e,n){let t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(n);return{lng:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height}}function T(e){let n=e||32,l="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",t=l.length,r="";for(let c=0;c<n;c++)r+=l.charAt(Math.floor(Math.random()*t));return r}export{E as C};
