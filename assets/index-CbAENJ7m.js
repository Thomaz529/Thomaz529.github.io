import{E as H}from"./index-DQKEvUsp.js";import{C as G}from"./CesiumEarth-D0reHEmA.js";import{_ as Q,c as Y,a as m,b,w as f,F as Z,r as T,o as j,d as w}from"./index-DQxC938F.js";function q(){const l=viewer.scene;l.debugShowFramesPerSecond=!0,Cesium.Math.setRandomNumberSeed(315);const e=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(-75.59777,40.03883)),i=new Cesium.Cartesian3(0,0,100);let s;function M(){if(!Cesium.defined(s)){s=document.createElement("canvas"),s.width=20,s.height=20;const n=s.getContext("2d");n.beginPath(),n.arc(8,8,8,0,Cesium.Math.TWO_PI,!0),n.closePath(),n.fillStyle="rgb(255, 255, 255)",n.fill()}return s}const u=30,t=100,r=new Cesium.Cartesian2(7,7),c=400,a=10,R=20,k=new Cesium.Matrix4;function _(n,d,S){const g=Cesium.Cartesian3.add(i,n,new Cesium.Cartesian3),C=Cesium.Matrix4.fromTranslation(g,k),p=Cesium.Matrix4.multiply(e,C,new Cesium.Matrix4),h=Cesium.Matrix4.inverseTransformation(p,p),o=Cesium.Math.randomBetween(u,t),A=new Cesium.Cartesian3,D=function(B){const $=Cesium.Matrix4.multiplyByPoint(h,B.position,A);Cesium.Cartesian3.magnitudeSquared($)>=o*o&&Cesium.Cartesian3.clone(Cesium.Cartesian3.ZERO,B.velocity)},W=(o-u)/(t-u),P=.3,V=W*(1-P)+P;l.primitives.add(new Cesium.ParticleSystem({image:M(),startColor:d,endColor:d.withAlpha(0),particleLife:V,speed:100,imageSize:r,emissionRate:0,emitter:new Cesium.SphereEmitter(.1),bursts:S,lifetime:a,updateCallback:D,modelMatrix:e,emitterModelMatrix:C}))}const z=-100,L=100,F=-80,I=100,N=-50,O=50,E=[{minimumRed:.75,green:0,minimumBlue:.8,alpha:1},{red:0,minimumGreen:.75,minimumBlue:.8,alpha:1},{red:0,green:0,minimumBlue:.8,alpha:1},{minimumRed:.75,minimumGreen:.75,blue:0,alpha:1}];for(let n=0;n<R;++n){const d=Cesium.Math.randomBetween(z,L),S=Cesium.Math.randomBetween(F,I),g=Cesium.Math.randomBetween(N,O),C=new Cesium.Cartesian3(d,S,g),p=Cesium.Color.fromRandom(E[n%E.length]),h=[];for(let o=0;o<3;++o)h.push(new Cesium.ParticleBurst({time:Cesium.Math.nextRandomNumber()*a,minimum:c,maximum:c}));_(C,p,h)}const x=viewer.scene.camera,y=new Cesium.Cartesian3(-300,0,0);x.lookAtTransform(e,y),x.lookAtTransform(Cesium.Matrix4.IDENTITY);const v=Cesium.Cartesian3.subtract(i,y,new Cesium.Cartesian3);Cesium.Cartesian3.normalize(v,v);const U=Cesium.Math.PI_OVER_TWO-Math.acos(Cesium.Cartesian3.dot(v,Cesium.Cartesian3.UNIT_Z));x.lookUp(U)}class J{constructor(e){this.viewer=e,this.viewModel={startScale:1,endScale:4,minimumParticleLife:1,maximumParticleLife:3,minimumSpeed:1,maximumSpeed:8,particleSize:20,emissionRate:5},this.emitterModelMatrix=new Cesium.Matrix4,this.translation=new Cesium.Cartesian3,this.rotation=new Cesium.Quaternion,this.hpr=new Cesium.HeadingPitchRoll,this.trs=new Cesium.TranslationRotationScale,this.scene=this.viewer.scene,this.particleSystem="",this.entity=this.viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(108.36,34.09,3e3)}),this.init()}init(){this.viewer.clock.shouldAnimate=!0,this.viewer.scene.globe.depthTestAgainstTerrain=!1;const e=10,i=20;var s=this.scene.primitives.add(new Cesium.ParticleSystem({emitter:new Cesium.ConeEmitter(Cesium.Math.toRadians(45)),image:"/src/assets/image/fire.png",startColor:Cesium.Color.RED,endColor:Cesium.Color.YELLOW,startScale:1,endScale:3,particleLife:1.5,speed:10,emissionRate:200,imageSize:new Cesium.Cartesian2(25,25),bursts:[new Cesium.ParticleBurst({time:0,minimum:e,maximum:i}),new Cesium.ParticleBurst({time:.1,minimum:e,maximum:i}),new Cesium.ParticleBurst({time:.2,minimum:e,maximum:i}),new Cesium.ParticleBurst({time:.3,minimum:e,maximum:i}),new Cesium.ParticleBurst({time:.4,minimum:e,maximum:i}),new Cesium.ParticleBurst({time:.5,minimum:e,maximum:i}),new Cesium.ParticleBurst({time:.6,minimum:e,maximum:i}),new Cesium.ParticleBurst({time:.7,minimum:e,maximum:i}),new Cesium.ParticleBurst({time:.8,minimum:e,maximum:i}),new Cesium.ParticleBurst({time:.9,minimum:e,maximum:i})]}));this.particleSystem=s,this.preUpdateEvent()}preUpdateEvent(){let e=this;this.viewer.scene.preUpdate.addEventListener(function(i,s){e.particleSystem.modelMatrix=e.computeModelMatrix(e.entity,s),e.particleSystem.emitterModelMatrix=e.computeEmitterModelMatrix(),e.viewModel.spin&&(e.viewModel.heading+=1,e.viewModel.pitch+=1,e.viewModel.roll+=1)})}computeModelMatrix(e,i){return e.computeModelMatrix(i,new Cesium.Matrix4)}computeEmitterModelMatrix(){return this.hpr=Cesium.HeadingPitchRoll.fromDegrees(0,0,0,this.hpr),this.trs.translation=Cesium.Cartesian3.fromElements(-4,0,1.4,this.translation),this.trs.rotation=Cesium.Quaternion.fromHeadingPitchRoll(this.hpr,this.rotation),Cesium.Matrix4.fromTranslationRotationScale(this.trs,this.emitterModelMatrix)}removeEvent(){this.viewer.scene.preUpdate.removeEventListener(this.preUpdateEvent,this),this.emitterModelMatrix=void 0,this.translation=void 0,this.rotation=void 0,this.hpr=void 0,this.trs=void 0}remove(){this.viewer.scene.primitives.remove(this.particleSystem),this.viewer.entities.remove(this.entity)}}const K={class:"toolButton"},X={class:"popup"},ee={__name:"index",setup(l){const e=()=>{q()},i=()=>{viewer.scene.postProcessStages.removeAll()},s=()=>{new G().createFireEffect()},M=()=>{new J(viewer)};return(u,t)=>{const r=T("el-button"),c=T("config");return j(),Y(Z,null,[m(H),b("div",K,[m(r,{type:"primary",onClick:t[0]||(t[0]=a=>e())},{default:f(()=>t[4]||(t[4]=[w("烟花")])),_:1}),m(r,{type:"primary",onClick:t[1]||(t[1]=a=>s())},{default:f(()=>t[5]||(t[5]=[w("火焰")])),_:1}),m(r,{type:"primary",onClick:t[2]||(t[2]=a=>M())},{default:f(()=>t[6]||(t[6]=[w("粒子火焰")])),_:1}),m(r,{type:"primary",onClick:t[3]||(t[3]=a=>i())},{default:f(()=>t[7]||(t[7]=[w("清除")])),_:1})]),b("div",X,[m(c)])],64)}}},re=Q(ee,[["__scopeId","data-v-097c04ab"]]);export{re as default};
