var b=Object.defineProperty;var I=(P,e,t)=>e in P?b(P,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):P[e]=t;var S=(P,e,t)=>(I(P,typeof e!="symbol"?e+"":e,t),t);import{E as x}from"./index-hnr1oFTy.js";import{p as R,l as H,b as $,c as W}from"./CesiumEarth-DSJv-lZu.js";import{_,j as O,c as z,a as T,b as G,w as A,F as V,r as X,o as N,d as L}from"./index-Do2SFHFE.js";function B(P,e){e===void 0&&(e={});var t=Number(P[0]),i=Number(P[1]),r=Number(P[2]),a=Number(P[3]);if(P.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var n=[t,i],s=[t,a],o=[r,a],l=[r,i];return R([[n,l,o,s,n]],e.properties,{bbox:P,id:e.id})}class Y{constructor(e){S(this,"getAttackArrowBodyPoints",function(e,t,i,r){for(var a=this,n=a.wholeDistance(e),s=a.getBaseLength(e),o=s*r,l=a.distance(t,i),h=(o-l)/2,c=0,u=[],p=[],g=1;g<e.length-1;g++){var v=a.getAngleOfThreePoints(e[g-1],e[g],e[g+1])/2;c+=a.distance(e[g-1],e[g]);var d=(o/2-c/n*h)/Math.sin(v),w=a.getThirdPoint(e[g-1],e[g],Math.PI-v,d,!0),m=a.getThirdPoint(e[g-1],e[g],v,d,!1);u.push(w),p.push(m)}return u.concat(p)});S(this,"getQBSplinePoints",function(e){if(e.length<=2)return e;var t=2,i=[],r=e.length-t-1,a=0;i.push(e[0]);for(var n=0;r>=n;n++)for(var s=0;1>=s;s+=.05){for(var o=a=0,l=0;t>=l;l++){var h=this.getQuadricBSplineFactor(l,s);o+=h*e[n+l][0],a+=h*e[n+l][1]}i.push([o,a])}return i.push(e[e.length-1]),i});S(this,"getQuadricBSplineFactor",function(e,t){return e==0?Math.pow(t-1,2)/2:e==1?(-2*Math.pow(t,2)+2*t+1)/2:e==2?Math.pow(t,2)/2:0});S(this,"array2Dto1D",function(e){var t=[];return e.forEach(function(i){t.push(i[0]),t.push(i[1])}),t});this.objId=+(new Date().getTime()+""+Number(Math.random()*1e3).toFixed(0)),this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event,this.viewer=e.viewer,this.Cesium=e.Cesium,this.identificationPoint=null,this.attackArrow=null,this.attackArrowLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesattackArrow=[],this.attackArrowData=null}getData(){return this.attackArrowData}addload(e){var t=this;if(e.length<3)return null;var i=t.fineArrow(e),r=i.polygonalPoint,a=t.viewer.entities.add({Type:"DrawSwallowArrow",Position:e,id:e.id||t.objId,polygon:{hierarchy:new t.Cesium.PolygonHierarchy(r),show:!0,fill:!0,clampToGround:!0,material:t.Cesium.Color.RED.withAlpha(.6)}});return a}computePosition(e){let t=this;for(var i=[],r=0;r<e.length;r++){var a=t.cartesianToLatlng(e[r]);i.push(a)}t.attackArrowData=i;var n=t.fineArrow(i),s=n.polygonalPoint;return new t.Cesium.PolygonHierarchy(s)}startCreate(e){this.drawType=e;var t=this;this.handler=new t.Cesium.ScreenSpaceEventHandler(t.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);t.positions.length==0&&(t.identificationPoint=t.createPoint(r),t.createPoint(r)),t.positions.length==1&&(t.positions.push(r.clone()),t.createPoint(r)),t.positions.push(r)},t.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<3)){var r=t.getCatesian3FromPX(i.endPosition);t.Cesium.defined(t.attackArrow)||(t.attackArrow=t.createAttackArrow()),t.identificationPoint.position.setValue(r),t.attackArrow&&(t.positions.pop(),t.positions.push(r))}},t.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);t.positions.pop(),t.attackArrowData=t.positions.concat(),t.viewer.entities.remove(t.attackArrow),t.attackArrow=null,t.positions=[],t.identificationPoint.position.setValue(r);let a=[];for(var n=0;n<t.attackArrowData.length;n++){var s=t.cartesianToLatlng(t.attackArrowData[n]);a.push(s)}t.attackArrowData=a;var o=t.addload(a);t.entitiesattackArrow.push(o),t.attackArrowLast=o,t.clearPoint(),t.destroy()},t.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createAttackArrow(){var e=this,t=e.viewer.entities.add({polygon:{hierarchy:new e.Cesium.CallbackProperty(function(){for(var i=[],r=0;r<e.positions.length;r++){var a=e.cartesianToLatlng(e.positions[r]);i.push(a)}var n=e.fineArrow(i),s=n.polygonalPoint;return new e.Cesium.PolygonHierarchy(s)},!1),show:!0,fill:!0,clampToGround:!0,material:e.Cesium.Color.RED.withAlpha(.6)}});return e.entitiesattackArrow.push(t),t}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.RED}});return i.objId=this.objId,t.entitiesPoint.push(i),i}cartesianToLatlng(e){let t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude),a=t.height;return[r,i,a]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clearPoint(){this.DrawEndEvent.raiseEvent(this.attackArrowLast,this.attackArrowData,this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesattackArrow.length;e++)this.viewer.entities.remove(this.entitiesattackArrow[e]);this.identificationPoint=null,this.attackArrow=null,this.attackArrowLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesattackArrow=[],this.attackArrowData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}fineArrowDefualParam(){return{headHeightFactor:.18,headWidthFactor:.3,neckHeightFactor:.85,neckWidthFactor:.15,tailWidthFactor:.1,headTailFactor:.8,swallowTailFactor:1}}fineArrow(e){var t=this;e=t.dereplication(e);let i=t.fineArrowDefualParam().tailWidthFactor,r=t.fineArrowDefualParam().swallowTailFactor,a=t.fineArrowDefualParam().swallowTailPnt;var n={controlPoint:null,polygonalPoint:null};n.controlPoint=e;var s=e.length;if(!(2>s)){if(e.length==2)return n.polygonalPoint=e,n;var o=e,l=o[0],h=o[1];t.isClockWise(o[0],o[1],o[2])&&(l=o[1],h=o[0]);var c=t.mid(l,h),u=[c].concat(o.slice(2)),p=t.getAttackArrowHeadPoints(u,l,h,t.fineArrowDefualParam()),g=p[0],v=p[4],d=t.distance(l,h),w=t.getBaseLength(u),m=w*i*r;a=t.getThirdPoint(u[1],u[0],0,m,!0);var C=d/w,f=t.getAttackArrowBodyPoints(u,g,v,C),s=f.length,y=[l].concat(f.slice(0,s/2));y.push(g);var D=[h].concat(f.slice(s/2,s)),E=[];D.push(v),y=t.getQBSplinePoints(y),D=t.getQBSplinePoints(D),E=t.array2Dto1D(y.concat(p,D.reverse(),[a,y[0]])),n.polygonalPoint=t.Cesium.Cartesian3.fromDegreesArray(E)}return n}getArrowBodyPoints(e,t,i,r){for(var a=this,n=a.wholeDistance(e),s=a.getBaseLength(e),o=s*r,l=a.distance(t,i),h=(o-l)/2,c=0,u=[],p=[],g=1;g<e.length-1;g++){var v=a.getAngleOfThreePoints(e[g-1],e[g],e[g+1])/2;c+=a.distance(e[g-1],e[g]);var d=(o/2-c/n*h)/Math.sin(v),w=a.getThirdPoint(e[g-1],e[g],Math.PI-v,d,!0),m=a.getThirdPoint(e[g-1],e[g],v,d,!1);u.push(w),p.push(m)}return u.concat(p)}getAttackArrowHeadPoints(e,t,i,r){var a=this;let n=r.headHeightFactor,s=r.headTailFactor,o=r.headWidthFactor,l=r.neckWidthFactor,h=r.neckHeightFactor;var c=a.getBaseLength(e),u=c*n,p=e[e.length-1];c=a.distance(p,e[e.length-2]);var g=a.distance(t,i);u>g*s&&(u=g*s);var v=u*o,d=u*l;u=u>c?c:u;var w=u*h,m=a.getThirdPoint(e[e.length-2],p,0,u,!0),C=a.getThirdPoint(e[e.length-2],p,0,w,!0),f=a.getThirdPoint(p,m,Math.PI/2,v,!1),y=a.getThirdPoint(p,m,Math.PI/2,v,!0),D=a.getThirdPoint(p,C,Math.PI/2,d,!1),E=a.getThirdPoint(p,C,Math.PI/2,d,!0);return[D,f,p,y,E]}getAngleOfThreePoints(e,t,i){var r=this.getAzimuth(t,e)-this.getAzimuth(t,i);return 0>r?r+Math.PI*2:r}dereplication(e){var t=e[e.length-1],i=!1,r=[];return r=e.filter(function(a){if(a[0]!=t[0]&&a[1]!=t[1])return a;i=!0}),i&&r.push(t),r}getBaseLength(e){return Math.pow(this.wholeDistance(e),.99)}wholeDistance(e){for(var t=0,i=0;i<e.length-1;i++)t+=this.distance(e[i],e[i+1]);return t}distance(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}getThirdPoint(e,t,i,r,a){var n=this.getAzimuth(e,t),s=a?n+i:n-i,o=r*Math.cos(s),l=r*Math.sin(s);return[t[0]+o,t[1]+l]}getAzimuth(e,t){var i,r=Math.asin(Math.abs(t[1]-e[1])/this.distance(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=r+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=2*Math.PI-r:t[1]<e[1]&&t[0]<e[0]?i=r:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-r),i}isClockWise(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])}mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}}class K{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.Cicle=null,this.identificationPoint=null,this.CicleLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesCicle=[],this.CicleData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}addload(e){var t=this;let i=[];for(var r=0;r<e.length;r++){var a=t.LatlngTocartesian(e[r]);i.push(a)}var n=i,s=Math.sqrt(Math.pow(n[0].x-n[n.length-1].x,2)+Math.pow(n[0].y-n[n.length-1].y,2)),o=n[0],l=t.viewer.entities.add({Type:"DrawCircle",Position:[e[0],e[e.length-1]],position:o,id:e.id||t.objId,ellipse:{semiMinorAxis:s,semiMajorAxis:s,material:t.Cesium.Color.RED.withAlpha(.9),show:!0,clampToGround:!0}});return l}getData(){return this.CicleData}computePosition(e){var t=this;let i=[];for(var r=0;r<e.length;r++){var a=t.cartesianToLatlng(e[r]);i.push(a)}t.CicleData=i;var n=e,s=Math.sqrt(Math.pow(n[0].x-n[n.length-1].x,2)+Math.pow(n[0].y-n[n.length-1].y,2)),o=n[0];return{position:o,r:s}}startCreate(e){this.drawType=e,this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.viewer.scene.globe.depthTestAgainstTerrain=!0;var t=this;this.handler.setInputAction(function(i){t.viewer.scene.globe.depthTestAgainstTerrain=!0;var r=t.getCatesian3FromPX(i.position);t.positions.length==0&&(t.positions.push(r.clone()),t.identificationPoint=t.createPoint(r),t.positions.push(r)),t.Cicle||t.createPoint(r)},t.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<1)){var r=t.viewer.scene.pickPosition(i.endPosition);t.Cesium.defined(t.Cicle)||(t.Cicle=t.createCicle()),t.identificationPoint.position.setValue(r),t.Cicle&&(t.positions.pop(),t.positions.push(r))}},t.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(!t.Cicle)return;t.viewer.scene.globe.depthTestAgainstTerrain=!1;var r=t.viewer.scene.pickPosition(i.position);t.positions.pop(),t.positions.push(r),t.CicleData=t.positions.concat(),t.viewer.entities.remove(t.Cicle),t.Cicle=null,t.positions=[],t.identificationPoint.position.setValue(r);let a=[];for(var n=0;n<t.CicleData.length;n++){var s=t.cartesianToLatlng(t.CicleData[n]);a.push(s)}t.CicleData=a;var o=t.addload(t.CicleData);t.entitiesCicle.push(o),t.CicleLast=o,t.clearPoint(),t.destroy()},t.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createCicle(){var e=this,t=this.viewer.entities.add({position:e.positions[0],ellipse:{semiMinorAxis:new e.Cesium.CallbackProperty(function(){var i=Math.sqrt(Math.pow(e.positions[0].x-e.positions[e.positions.length-1].x,2)+Math.pow(e.positions[0].y-e.positions[e.positions.length-1].y,2));return i||i+1},!1),semiMajorAxis:new e.Cesium.CallbackProperty(function(){var i=Math.sqrt(Math.pow(e.positions[0].x-e.positions[e.positions.length-1].x,2)+Math.pow(e.positions[0].y-e.positions[e.positions.length-1].y,2));return i||i+1},!1),material:e.Cesium.Color.RED.withAlpha(.5),outline:!0}});return e.entitiesCicle.push(t),t}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.YELLOW}});return t.entitiesPoint.push(i),i}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}cartesianToLatlng(e){let t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return t.height,[r,i]}LatlngTocartesian(e){return this.Cesium.Cartesian3.fromDegrees(e[0],e[1],0)}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clearPoint(){this.DrawEndEvent.raiseEvent(this.CicleLast,this.CicleData,this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesCicle.length;e++)this.viewer.entities.remove(this.entitiesCicle[e]);this.Cicle=null,this.identificationPoint=null,this.CicleLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesCicle=[],this.CicleData=null}}class U{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.identificationPoint=null,this.Curveline=null,this.CurvelineLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesLine=[],this.CurvelineData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event,this.ZERO_TOLERANCE=1e-4,this.FITTING_COUNT=100,this.t=.3}getData(){return this.CurvelineData}addload(e){var t=this;let i=[];for(let s=0;s<e.length;s++)i.push(t.lonLatToMercator(e[s]));let r=t.getCurvePoints(i),a=[];for(let s=0;s<r.length;s++)a.push(t.LatlngTocartesian(t.WebMercator2lonLat(r[s])));var n=this.viewer.entities.add({Type:"DrawCurve",Position:e,id:e.id||t.objId,polyline:{positions:a,show:!0,material:t.Cesium.Color.YELLOW,width:3,clampToGround:!0}});return n}computePosition(e){let t=[],i=[];for(let n=0;n<e.length;n++)i.push(this.cartesianToLatlng(e[n])),t.push(this.lonLatToMercator(this.cartesianToLatlng(e[n])));this.CurvelineData=i;let r=this.getCurvePoints(t),a=[];for(let n=0;n<r.length;n++)a.push(this.LatlngTocartesian(this.WebMercator2lonLat(r[n])));return a}startCreate(e){this.drawType=e;var t=this;this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);t.positions.length==0&&(t.positions.push(r.clone()),t.identificationPoint=t.createPoint(r),t.createPoint(r)),t.positions.push(r)},t.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<3)){var r=t.getCatesian3FromPX(i.endPosition);t.Cesium.defined(t.Curveline)||(t.Curveline=t.createCurveline()),t.identificationPoint.position.setValue(r),t.Curveline&&(t.positions.pop(),t.positions.push(r))}},t.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(!t.Curveline)return;var r=t.getCatesian3FromPX(i.position);t.positions.pop(),t.positions.push(r),t.createPoint(r),t.CurvelineData=t.positions.concat(),t.viewer.entities.remove(t.Curveline),t.Curveline=null,t.positions=[],t.identificationPoint.position.setValue(r);let a=[];for(var n=0;n<t.CurvelineData.length;n++){var s=t.cartesianToLatlng(t.CurvelineData[n]);a.push(s)}t.CurvelineData=a;var o=t.addload(t.CurvelineData);t.entitiesLine.push(o),t.CurvelineLast=o,t.clearPoint(),t.destroy()},t.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.YELLOW}});return t.entitiesPoint.push(i),i}createCurveline(){var e=this,t=this.viewer.entities.add({polyline:{positions:new e.Cesium.CallbackProperty(function(){let i=[];for(let n=0;n<e.positions.length;n++)i.push(e.lonLatToMercator(e.cartesianToLatlng(e.positions[n])));let r=e.getCurvePoints(i),a=[];for(let n=0;n<r.length;n++)a.push(e.LatlngTocartesian(e.WebMercator2lonLat(r[n])));return a},!1),show:!0,material:e.Cesium.Color.YELLOW,width:3,clampToGround:!0}});return e.entitiesLine.push(t),t}clearPoint(){this.DrawEndEvent.raiseEvent(this.CurvelineLast,this.CurvelineData,this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesLine.length;e++)this.viewer.entities.remove(this.entitiesLine[e]);this.identificationPoint=null,this.Curveline=null,this.CurvelineLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesLine=[],this.CurvelineData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}cartesianToLatlng(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return[r,i]}LatlngTocartesian(e){return this.Cesium.Cartesian3.fromDegrees(e[0],e[1])}lonLatToMercator(e){var t=e[0],i=e[1],r=t*2003750834e-2/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*2003750834e-2/180,[r,a]}WebMercator2lonLat(e){let t=e[0]/2003750834e-2*180,i=e[1]/2003750834e-2*180,r=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2);return[t,r]}getCurvePoints(e){let t=this.getLeftMostControlPoint(e,this.t),[i,r,a,n,s]=[null,null,null,[t],[]];for(let l=0;l<e.length-2;l++){[i,r,a]=[e[l],e[l+1],e[l+2]];let h=this.getBisectorNormals(this.t,i,r,a);n=n.concat(h)}let o=this.getRightMostControlPoint(e,this.t);o&&n.push(o);for(let l=0;l<e.length-1;l++){i=e[l],r=e[l+1],s.push(i);for(let h=0;h<this.FITTING_COUNT;h++){let c=this.getCubicValue(h/this.FITTING_COUNT,i,n[l*2],n[l*2+1],r);s.push(c)}s.push(r)}return s}getLeftMostControlPoint(e,t){let[i,r,a,n,s]=[e[0],e[1],e[2],null,null],l=this.getBisectorNormals(0,i,r,a)[0],h=this.getNormal(i,r,a);if(Math.sqrt(h[0]*h[0]+h[1]*h[1])>this.ZERO_TOLERANCE){let u=this.Mid(i,r),p=i[0]-u[0],g=i[1]-u[1],d=2/this.MathDistance(i,r),w=-d*g,m=d*p,C=w*w-m*m,f=2*w*m,y=m*m-w*w,D=l[0]-u[0],E=l[1]-u[1];n=u[0]+C*D+f*E,s=u[1]+f*D+y*E}else n=i[0]+t*(r[0]-i[0]),s=i[1]+t*(r[1]-i[1]);return[n,s]}getBisectorNormals(e,t,i,r){let a=this.getNormal(t,i,r),[n,s,o,l,h]=[null,null,null,null,null],c=Math.sqrt(a[0]*a[0]+a[1]*a[1]),u=a[0]/c,p=a[1]/c,g=this.MathDistance(t,i),v=this.MathDistance(i,r);return c>this.ZERO_TOLERANCE?this.isClockWise(t,i,r)?(o=e*g,l=i[0]-o*p,h=i[1]+o*u,n=[l,h],o=e*v,l=i[0]+o*p,h=i[1]-o*u,s=[l,h]):(o=e*g,l=i[0]+o*p,h=i[1]-o*u,n=[l,h],o=e*v,l=i[0]-o*p,h=i[1]+o*u,s=[l,h]):(l=i[0]+e*(t[0]-i[0]),h=i[1]+e*(t[1]-i[1]),n=[l,h],l=i[0]+e*(r[0]-i[0]),h=i[1]+e*(r[1]-i[1]),s=[l,h]),[n,s]}getNormal(e,t,i){let r=e[0]-t[0],a=e[1]-t[1],n=Math.sqrt(r*r+a*a);r/=n,a/=n;let s=i[0]-t[0],o=i[1]-t[1],l=Math.sqrt(s*s+o*o);s/=l,o/=l;let h=r+s,c=a+o;return[h,c]}isClockWise(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])}Mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}MathDistance(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}getRightMostControlPoint(e,t){let i=e.length,r=e[i-3],a=e[i-2],n=e[i-1],o=this.getBisectorNormals(0,r,a,n)[1],l=this.getNormal(r,a,n),h=Math.sqrt(l[0]*l[0]+l[1]*l[1]),[c,u]=[null,null];if(h>this.ZERO_TOLERANCE){let p=this.Mid(a,n),g=n[0]-p[0],v=n[1]-p[1],w=2/this.MathDistance(a,n),m=-w*v,C=w*g,f=m*m-C*C,y=2*m*C,D=C*C-m*m,E=o[0]-p[0],k=o[1]-p[1];c=p[0]+f*E+y*k,u=p[1]+y*E+D*k}else c=n[0]+t*(a[0]-n[0]),u=n[1]+t*(a[1]-n[1]);return[c,u]}getCubicValue(e,t,i,r,a){e=Math.max(Math.min(e,1),0);let[n,s]=[1-e,e*e],o=s*e,l=n*n,h=l*n,c=h*t[0]+3*l*e*i[0]+3*n*s*r[0]+o*a[0],u=h*t[1]+3*l*e*i[1]+3*n*s*r[1]+o*a[1];return[c,u]}}class j{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.identificationPoint=null,this.PincerArrow=null,this.PincerArrowLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesPincerArrow=[],this.PincerArrowData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}getData(){return this.PincerArrowData}addload(e){var t=this;if(!(e.length<3)){var i=t.doubleArrow(e),r=i.polygonalPoint,a=t.viewer.entities.add({Type:"DrawPincerArrow",Position:e,id:e.id||t.objId,polygon:{hierarchy:new t.Cesium.PolygonHierarchy(r),show:!0,fill:!0,clampToGround:!0,material:t.Cesium.Color.RED.withAlpha(.6)}});return a}}computePosition(e){let t=this;for(var i=[],r=0;r<e.length;r++){var a=t.cartesianToLatlng(e[r]);i.push(a)}t.PincerArrowData=i;var n=t.doubleArrow(i),s=n.polygonalPoint;return new t.Cesium.PolygonHierarchy(s)}startCreate(e){this.drawType=e;var t=this;this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),t.viewer.scene.globe.depthTestAgainstTerrain=!1,this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);r&&(t.positions.length==0&&(t.identificationPoint=t.createPoint(r)),t.positions.length<5&&(t.positions.push(r),t.createPoint(r)),t.positions.length==5&&(t.positions[4]=r,t.identificationPoint.position.setValue(r)))},t.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.endPosition);r&&(t.positions.length<2||(t.Cesium.defined(t.PincerArrow)||(t.positions.length==2&&t.positions.push(r),t.PincerArrow=t.createPincerArrow()),t.identificationPoint.position.setValue(r),t.positions.length==3&&(t.positions[2]=r),t.positions.length>3&&(t.positions.pop(),t.positions.push(r)),console.log(t.positions.length)))},t.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(t.PincerArrow){var r=t.getCatesian3FromPX(i.position);if(r){t.positions.pop(),t.positions.push(r),t.PincerArrowData=t.positions.concat(),t.viewer.entities.remove(t.PincerArrow),t.PincerArrow=null,t.positions=[],t.identificationPoint.position.setValue(r);for(var a=[],n=0;n<t.PincerArrowData.length;n++){var s=t.cartesianToLatlng(t.PincerArrowData[n]);a.push(s)}t.PincerArrowData=a;var o=t.addload(a);t.entitiesPincerArrow.push(o),t.PincerArrowLast=o,t.clearPoint(),t.destroy()}}},t.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createPincerArrow(){var e=this;e._computeTempPositions();var t=e.viewer.entities.add({polygon:{hierarchy:new e.Cesium.CallbackProperty(function(){for(var i=[],r=0;r<e.positions.length;r++){var a=e.cartesianToLatlng(e.positions[r]);i.push(a)}var n=e.doubleArrow(i),s=n.polygonalPoint;return new e.Cesium.PolygonHierarchy(s)},!1),show:!0,fill:!0,clampToGround:!0,material:e.Cesium.Color.RED.withAlpha(.6)}});return e.entitiesPincerArrow.push(t),t}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.RED}});return t.entitiesPoint.push(i),i}cartesianToLatlng(e){let t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude),a=t.height;return[r,i,a]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clearPoint(){this.DrawEndEvent.raiseEvent(this.PincerArrowLast,this.PincerArrowData,this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesPincerArrow.length;e++)this.viewer.entities.remove(this.entitiesPincerArrow[e]);this.identificationPoint=null,this.PincerArrow=null,this.PincerArrowLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesPincerArrow=[],this.PincerArrowData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}_computeTempPositions(){var e=this,t=[].concat(e.positions),i=t.length,r=t[0],a=t[i-1];e._isSimpleXYZ(r,a)==!1&&(t.push(r),i+=1),e.tempPositions=[];for(var n=1;n<i;n++){var s=t[n-1],o=t[n],l=e._computeCenterPotition(s,o);e.tempPositions.push(s),e.tempPositions.push(l)}}_isSimpleXYZ(e,t){return e.x==t.x&&e.y==t.y&&e.z==t.z}_computeCenterPotition(e,t){var i=this,r=i.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),a=i.viewer.scene.globe.ellipsoid.cartesianToCartographic(t),n=new i.Cesium.EllipsoidGeodesic(r,a).interpolateUsingFraction(.5),s=i.viewer.scene.globe.ellipsoid.cartographicToCartesian(n);return s}doubleArrow(e){var t=this;this.connPoint=null,this.tempPoint4=null,this.points=e;var i={controlPoint:null,polygonalPoint:null},r=e.length;if(!(2>r)){if(r==2)return e;var a=this.points[0],n=this.points[1],s=this.points[2],r=e.length;r==3?this.tempPoint4=t.getTempPoint4(a,n,s):this.tempPoint4=this.points[3],r==3||r==4?this.connPoint=t.mid(a,n):this.connPoint=this.points[4];var o,l;t.isClockWise(a,n,s)?(o=t.getArrowPoints(a,this.connPoint,this.tempPoint4,!1),l=t.getArrowPoints(this.connPoint,n,s,!0)):(o=t.getArrowPoints(n,this.connPoint,s,!1),l=t.getArrowPoints(this.connPoint,a,this.tempPoint4,!0));var h=o.length,c=(h-5)/2,u=o.slice(0,c),p=o.slice(c,c+5),g=o.slice(c+5,h),v=l.slice(0,c),d=l.slice(c,c+5),w=l.slice(c+5,h);v=t.getBezierPoints(v);var m=t.getBezierPoints(w.concat(u.slice(1)));g=t.getBezierPoints(g);var C=v.concat(d,m,p,g),f=t.array2Dto1D(C);i.controlPoint=[a,n,s,this.tempPoint4,this.connPoint],i.polygonalPoint=t.Cesium.Cartesian3.fromDegreesArray(f)}return i}getTempPoint4(e,t,i){var r=this,a,n,s,o,l=r.mid(e,t),h=r.distance(l,i),c=r.getAngleOfThreePoints(e,l,i);return c<Math.PI/2?(n=h*Math.sin(c),s=h*Math.cos(c),o=r.getThirdPoint(e,l,Math.PI/2,n,!1),a=r.getThirdPoint(l,o,Math.PI/2,s,!0)):c>=Math.PI/2&&c<Math.PI?(n=h*Math.sin(Math.PI-c),s=h*Math.cos(Math.PI-c),o=r.getThirdPoint(e,l,Math.PI/2,n,!1),a=r.getThirdPoint(l,o,Math.PI/2,s,!1)):c>=Math.PI&&c<1.5*Math.PI?(n=h*Math.sin(c-Math.PI),s=h*Math.cos(c-Math.PI),o=r.getThirdPoint(e,l,Math.PI/2,n,!0),a=r.getThirdPoint(l,o,Math.PI/2,s,!0)):(n=h*Math.sin(2*Math.PI-c),s=h*Math.cos(2*Math.PI-c),o=r.getThirdPoint(e,l,Math.PI/2,n,!0),a=r.getThirdPoint(l,o,Math.PI/2,s,!1)),a}mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}isClockWise(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])}getArrowPoints(e,t,i,r){var a=this,n={type:"doublearrow",headHeightFactor:.25,headWidthFactor:.3,neckHeightFactor:.85,fixPointCount:4,neckWidthFactor:.15};this.type=n.type,this.headHeightFactor=n.headHeightFactor,this.headWidthFactor=n.headWidthFactor,this.neckHeightFactor=n.neckHeightFactor,this.neckWidthFactor=n.neckWidthFactor;var s=a.mid(e,t),o=a.distance(s,i),l=a.getThirdPoint(i,s,0,.3*o,!0),h=a.getThirdPoint(i,s,0,.5*o,!0);l=a.getThirdPoint(s,l,Math.PI/2,o/5,r),h=a.getThirdPoint(s,h,Math.PI/2,o/4,r);var c=[s,l,h,i],u=a.getArrowHeadPoints(c,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),p=u[0],g=u[4],v=a.distance(e,t)/a.getBaseLength(c)/2,d=a.getArrowBodyPoints(c,p,g,v),w=d.length,m=d.slice(0,w/2),C=d.slice(w/2,w);return m.push(p),C.push(g),m=m.reverse(),m.push(t),C=C.reverse(),C.push(e),m.reverse().concat(u,C)}getArrowHeadPoints(e,t,i){var r=this,a={type:"doublearrow",headHeightFactor:.25,headWidthFactor:.3,neckHeightFactor:.85,fixPointCount:4,neckWidthFactor:.15};this.type=a.type,this.headHeightFactor=a.headHeightFactor,this.headWidthFactor=a.headWidthFactor,this.neckHeightFactor=a.neckHeightFactor,this.neckWidthFactor=a.neckWidthFactor;var n=r.getBaseLength(e),s=n*this.headHeightFactor,o=e[e.length-1],l=(r.distance(t,i),s*this.headWidthFactor),h=s*this.neckWidthFactor,c=s*this.neckHeightFactor,u=r.getThirdPoint(e[e.length-2],o,0,s,!0),p=r.getThirdPoint(e[e.length-2],o,0,c,!0),g=r.getThirdPoint(o,u,Math.PI/2,l,!1),v=r.getThirdPoint(o,u,Math.PI/2,l,!0),d=r.getThirdPoint(o,p,Math.PI/2,h,!1),w=r.getThirdPoint(o,p,Math.PI/2,h,!0);return[d,g,o,v,w]}getArrowBodyPoints(e,t,i,r){for(var a=this,n=a.wholeDistance(e),s=a.getBaseLength(e),o=s*r,l=a.distance(t,i),h=(o-l)/2,c=0,u=[],p=[],g=1;g<e.length-1;g++){var v=a.getAngleOfThreePoints(e[g-1],e[g],e[g+1])/2;c+=a.distance(e[g-1],e[g]);var d=(o/2-c/n*h)/Math.sin(v),w=a.getThirdPoint(e[g-1],e[g],Math.PI-v,d,!0),m=a.getThirdPoint(e[g-1],e[g],v,d,!1);u.push(w),p.push(m)}return u.concat(p)}getBezierPoints(e){if(e.length<=2)return e;for(var t=[],i=e.length-1,r=0;1>=r;r+=.01){for(var a=0,n=0,s=0;i>=s;s++){var o=this.getBinomialFactor(i,s),l=Math.pow(r,s),h=Math.pow(1-r,i-s);a+=o*l*h*e[s][0],n+=o*l*h*e[s][1]}t.push([a,n])}return t.push(e[i]),t}getBaseLength(e){return Math.pow(this.wholeDistance(e),.99)}wholeDistance(e){for(var t=0,i=0;i<e.length-1;i++)t+=this.distance(e[i],e[i+1]);return t}getBinomialFactor(e,t){return this.getFactorial(e)/(this.getFactorial(t)*this.getFactorial(e-t))}getFactorial(e){if(1>=e)return 1;if(e==2)return 2;if(e==3)return 6;if(e==4)return 24;if(e==5)return 120;for(var t=1,i=1;e>=i;i++)t*=i;return t}array2Dto1D(e){var t=[];return e.forEach(function(i){t.push(i[0]),t.push(i[1])}),t}distance(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}getAngleOfThreePoints(e,t,i){var r=this.getAzimuth(t,e)-this.getAzimuth(t,i);return 0>r?r+2*Math.PI:r}getAzimuth(e,t){var i,r=Math.asin(Math.abs(t[1]-e[1])/this.distance(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=r+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=2*Math.PI-r:t[1]<e[1]&&t[0]<e[0]?i=r:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-r),i}getThirdPoint(e,t,i,r,a){var n=this.getAzimuth(e,t),s=a?n+i:n-i,o=r*Math.cos(s),l=r*Math.sin(s);return[t[0]+o,t[1]+l]}}class q{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.Point=null,this.PointData=null,this.Entities=[],this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}addload(e){return this.createPoint(e)}getData(){return this.PointData}computePosition(e){let t=this;for(var i=[],r=0;r<e.length;r++){var a=t.cartesianToLatlng(e[r]);i.push(a)}t.PointData=i;let n=i[0];return t.Cesium.Cartesian3.fromDegrees(n[0],n[1])}startCreate(e){this.drawType=e;var t=this;this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);if(!r)return;let a=t.cartesianToLatlng(r);var n=t.createPoint(a);t.PointData=r,t.Point=n,t.DrawEndEvent.raiseEvent(t.Point,a,t.drawType),t.destroy()},t.Cesium.ScreenSpaceEventType.LEFT_CLICK)}createPoint(e){var t=this,i=this.viewer.entities.add({Type:"DrawPoint",Position:[e],position:t.Cesium.Cartesian3.fromDegrees(e[0],e[1]),id:e.id||t.objId,billboard:{image:"/src/assets/image/point.png",verticalOrigin:Cesium.VerticalOrigin.BOTTOM}});return t.Entities.push(i),i}cartesianToLatlng(e){let i=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),r=Cesium.Math.toDegrees(i.latitude);return[Cesium.Math.toDegrees(i.longitude),r]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clear(){for(var e=0;e<this.Entities.length;e++)this.viewer.entities.remove(this.Entities[e]);this.Point=null,this.PointData=null,this.Entities=[]}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}}class Z{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.Polygon=null,this.PolygonLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesPolygon=[],this.PolygonData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}getData(){return this.PolygonData}computePosition(e){let t=this;for(var i=[],r=0;r<e.length;r++){var a=t.cartesianToLatlng(e[r]);i.push(a)}return t.PolygonData=i,new t.Cesium.PolygonHierarchy(e)}addload(e){for(var t=this,i=[],r=0;r<e.length;r++){var a=t.LatlngTocartesian(e[r]);i.push(a)}return this.viewer.entities.add({Type:"DrawPolygon",Position:e,id:e.id||t.objId,polygon:{hierarchy:new t.Cesium.PolygonHierarchy(i),clampToGround:!0,show:!0,fill:!0,material:t.Cesium.Color.RED.withAlpha(.9),width:3,outlineColor:t.Cesium.Color.BLACK,outlineWidth:1,outline:!1}})}startCreate(e){this.drawType=e;var t=this;this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);t.positions.length==0&&t.positions.push(r.clone()),t.createPoint(r),t.positions.push(r)},t.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<1)){var r=t.getCatesian3FromPX(i.endPosition);t.positions.length==3&&(t.Cesium.defined(t.Polygon)||(t.Polygon=t.createPolygon())),t.positions.pop(),t.positions.push(r)}},t.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(t.Polygon){var r=t.getCatesian3FromPX(i.position);t.positions.pop(),t.createPoint(r),t.PolygonData=t.positions.concat(),t.viewer.entities.remove(t.positions),t.positions=null,t.positions=[];for(var a=[],n=0;n<t.PolygonData.length;n++){var s=t.cartesianToLatlng(t.PolygonData[n]);a.push(s)}t.PolygonData=a;var o=t.addload(t.PolygonData);t.entitiesPolygon.push(o),t.PolygonLast=o,t.clearPoint(),t.destroy()}},t.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createPolygon(){var e=this,t=this.viewer.entities.add({polygon:{hierarchy:new e.Cesium.CallbackProperty(function(){return new e.Cesium.PolygonHierarchy(e.positions)},!1),clampToGround:!0,show:!0,fill:!0,material:e.Cesium.Color.RED.withAlpha(.5),width:3,outlineColor:e.Cesium.Color.BLACK,outlineWidth:1,outline:!1}});return e.entitiesPolygon.push(t),t}cartesianToLatlng(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return[r,i]}LatlngTocartesian(e){return this.Cesium.Cartesian3.fromDegrees(e[0],e[1])}clearPoint(){this.DrawEndEvent.raiseEvent(this.PolygonLast,this.PolygonData,this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.YELLOW}});return t.entitiesPoint.push(i),i}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesPolygon.length;e++)this.viewer.entities.remove(this.entitiesPolygon[e]);this.Polygon=null,this.PolygonLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesPolygon=[],this.PolygonData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}}class Q{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.Polyline=null,this.PolylineLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesLine=[],this.PolylineData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}getData(){return this.PolylineData}computePosition(e){let t=this;for(var i=[],r=0;r<e.length;r++){var a=t.cartesianToLatlng(e[r]);i.push(a)}return t.PolylineData=i,e}addload(e){for(var t=this,i=[],r=0;r<e.length;r++){var a=t.LatlngTocartesian(e[r]);i.push(a)}var n=this.viewer.entities.add({Type:"DrawPolyline",Position:e,id:e.id||t.objId,polyline:{positions:i,show:!0,material:t.Cesium.Color.RED,width:3,clampToGround:!0}});return n}startCreate(e){this.drawType=e;var t=this;this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);t.positions.length==0&&t.positions.push(r.clone()),t.positions.push(r),t.createPoint(r)},t.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<1)){var r=t.getCatesian3FromPX(i.endPosition);t.Cesium.defined(t.Polyline)||(t.Polyline=t.createPolyline()),t.Polyline&&(t.positions.pop(),t.positions.push(r))}},t.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(t.Polyline){var r=t.getCatesian3FromPX(i.position);t.positions.pop(),t.createPoint(r),t.PolylineData=t.positions.concat(),t.viewer.entities.remove(t.Polyline),t.Polyline=null,t.positions=[];for(var a=[],n=0;n<t.PolylineData.length;n++){var s=t.cartesianToLatlng(t.PolylineData[n]);a.push(s)}t.PolylineData=a;var o=t.addload(t.PolylineData);t.entitiesLine.push(o),t.PolylineLast=o,t.clearPoint(),t.destroy()}},t.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.YELLOW}});return t.entitiesPoint.push(i),i}createPolyline(){var e=this,t=this.viewer.entities.add({polyline:{positions:new e.Cesium.CallbackProperty(function(){return e.positions},!1),show:!0,material:e.Cesium.Color.RED,width:3,clampToGround:!0}});return e.entitiesLine.push(t),t}cartesianToLatlng(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return[r,i]}LatlngTocartesian(e){return this.Cesium.Cartesian3.fromDegrees(e[0],e[1])}clearPoint(){this.DrawEndEvent.raiseEvent(this.PolylineLast,this.PolylineData,this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesLine.length;e++)this.viewer.entities.remove(this.entitiesLine[e]);this.Polyline=null,this.PolylineLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesLine=[],this.PolylineData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}}class J{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.identificationPoint=null,this.Rectangle=null,this.RectangleLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesRectangle=[],this.RectangleData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}getData(){return this.RectangleData}computePosition(e){let t=this;for(var i=[],r=0;r<e.length;r++){var a=t.cartesianToLatlng(e[r]);i.push(a)}return t.RectangleData=i,new t.Cesium.Rectangle.fromCartesianArray(e)}addload(e){for(var t=this,i=[],r=0;r<e.length;r++){var a=t.LatlngTocartesian(e[r]);i.push(a)}var n=this.viewer.entities.add({Type:"DrawRectangle",Position:e,id:e.id||t.objId,rectangle:{coordinates:t.Cesium.Rectangle.fromCartesianArray(i),material:t.Cesium.Color.RED.withAlpha(.9)}});return t.entitiesRectangle.push(n),n}startCreate(e){this.drawType=e;var t=this;this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);t.positions.length==0&&(t.positions.push(r.clone()),t.identificationPoint=t.createPoint(r),t.createPoint(r),t.positions.push(r)),t.positions.length==2&&t.positions.push(r)},t.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<3)){var r=t.getCatesian3FromPX(i.endPosition);t.Cesium.defined(t.Rectangle)||(t.Rectangle=t.createRectangle()),t.identificationPoint.position.setValue(r),t.Rectangle&&(t.positions.pop(),t.positions.push(r))}},t.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(t.Rectangle){var r=t.getCatesian3FromPX(i.position);t.positions.pop(),t.positions.push(r),t.createPoint(r),t.RectangleData=t.positions.concat(),t.viewer.entities.remove(t.Rectangle),t.Rectangle=null,t.positions=[],t.identificationPoint.position.setValue(r);for(var a=[],n=0;n<t.RectangleData.length;n++){var s=t.cartesianToLatlng(t.RectangleData[n]);a.push(s)}t.RectangleData=a;var o=t.addload([t.RectangleData[0],t.RectangleData[t.RectangleData.length-1]]);t.entitiesRectangle.push(o),t.RectangleLast=o,t.clearPoint(),t.destroy()}},t.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.YELLOW}});return t.entitiesPoint.push(i),i}createRectangle(){var e=this,t=this.viewer.entities.add({name:"rectangle",rectangle:{coordinates:new e.Cesium.CallbackProperty(function(){var i=e.Cesium.Rectangle.fromCartesianArray(e.positions);return i},!1),material:e.Cesium.Color.RED.withAlpha(.5)}});return e.entitiesRectangle.push(t),t}cartesianToLatlng(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return[r,i]}LatlngTocartesian(e){return this.Cesium.Cartesian3.fromDegrees(e[0],e[1])}clearPoint(){this.DrawEndEvent.raiseEvent(this.RectangleLast,[this.RectangleData[0],this.RectangleData[this.RectangleData.length-1]],this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesRectangle.length;e++)this.viewer.entities.remove(this.entitiesRectangle[e]);this.identificationPoint=null,this.Rectangle=null,this.RectangleLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesRectangle=[],this.RectangleData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}}class tt{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.identificationPoint=null,this.StraightArrow=null,this.StraightArrowLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesStraightArrow=[],this.StraightArrowData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}getData(){return this.StraightArrowData}computePosition(e){for(var t=this,i=e.length,r=e[0],a=e[i-1],n=t.cartesianToLatlng(r),s=t.cartesianToLatlng(a),o=[],l=t.fineArrow([n[0],n[1]],[s[0],s[1]]),h=0;h<l.length;h++){var c=new t.Cesium.Cartesian3(l[h].x,l[h].y,l[h].z);o.push(c)}return t.StraightArrowData=[n,s],new t.Cesium.PolygonHierarchy(o)}addload(e){var t=this;if(e.length<2)return null;for(var i=e.length,r=e[0],a=e[i-1],n=[],s=t.fineArrow([r[0],r[1]],[a[0],a[1]]),o=0;o<s.length;o++){var l=new t.Cesium.Cartesian3(s[o].x,s[o].y,s[o].z);n.push(l)}var h=t.viewer.entities.add({Type:"DrawStraightArrow",Position:e,id:e.id||t.objId,polygon:{hierarchy:new t.Cesium.PolygonHierarchy(n),show:!0,fill:!0,clampToGround:!0,material:t.Cesium.Color.RED.withAlpha(.6)}});return h}startCreate(e){this.drawType=e;var t=this;this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);t.positions.length==0&&(t.positions.push(r.clone()),t.identificationPoint=t.createPoint(r),t.positions.push(r)),t.StraightArrow||t.createPoint(r)},t.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<2)){var r=t.getCatesian3FromPX(i.endPosition);t.Cesium.defined(t.StraightArrow)||(t.StraightArrow=t.createStraightArrow()),t.identificationPoint.position.setValue(r),t.StraightArrow&&(t.positions.pop(),t.positions.push(r))}},t.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(t.StraightArrow){var r=t.getCatesian3FromPX(i.position);t.positions.pop(),t.positions.push(r),t.StraightArrowData=t.positions.concat(),t.viewer.entities.remove(t.StraightArrow),t.StraightArrow=null,t.positions=[],t.identificationPoint.position.setValue(r);for(var a=[],n=0;n<t.StraightArrowData.length;n++){var s=t.cartesianToLatlng(t.StraightArrowData[n]);a.push(s)}t.StraightArrowData=a;var o=t.addload(t.StraightArrowData);t.entitiesStraightArrow.push(o),t.StraightArrowLast=o,t.clearPoint(),t.destroy()}},t.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createStraightArrow(){var e=this,t=e.viewer.entities.add({polygon:{hierarchy:new e.Cesium.CallbackProperty(function(){for(var i=e.positions.length,r=e.positions[0],a=e.positions[i-1],n=e.cartesianToLatlng(r),s=e.cartesianToLatlng(a),o=[],l=e.fineArrow([n[0],n[1]],[s[0],s[1]]),h=0;h<l.length;h++){var c=new e.Cesium.Cartesian3(l[h].x,l[h].y,l[h].z);o.push(c)}return new e.Cesium.PolygonHierarchy(o)},!1),show:!0,fill:!0,clampToGround:!0,material:e.Cesium.Color.RED.withAlpha(.6)}});return e.entitiesStraightArrow.push(t),t}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.YELLOW}});return t.entitiesPoint.push(i),i}cartesianToLatlng(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return[r,i]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clearPoint(){this.DrawEndEvent.raiseEvent(this.StraightArrowLast,this.StraightArrowData,this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesStraightArrow.length;e++)this.viewer.entities.remove(this.entitiesStraightArrow[e]);this.identificationPoint=null,this.StraightArrow=null,this.StraightArrowLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesStraightArrow=[],this.StraightArrowData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}fineArrowDefualParam(){return{tailWidthFactor:.15,neckWidthFactor:.2,headWidthFactor:.25,headAngle:Math.PI/8.5,neckAngle:Math.PI/13}}fineArrow(e,t){var i=this;if(e.length<2||t.length<2)return;let r=i.fineArrowDefualParam().tailWidthFactor,a=i.fineArrowDefualParam().neckWidthFactor,n=i.fineArrowDefualParam().headWidthFactor,s=i.fineArrowDefualParam().headAngle,o=i.fineArrowDefualParam().neckAngle;var l=[];l[0]=e,l[1]=t;var h=l[0],c=l[1],u=i.getBaseLength(l),p=u*r,g=u*a,v=u*n,d=i.getThirdPoint(c,h,Math.PI/2,p,!0),w=i.getThirdPoint(c,h,Math.PI/2,p,!1),m=i.getThirdPoint(h,c,s,v,!1),C=i.getThirdPoint(h,c,s,v,!0),f=i.getThirdPoint(h,c,o,g,!1),y=i.getThirdPoint(h,c,o,g,!0),D=[];return D.push(d[0],d[1],f[0],f[1],m[0],m[1],c[0],c[1],C[0],C[1],y[0],y[1],w[0],w[1],h[0],h[1]),i.Cesium.Cartesian3.fromDegreesArray(D)}getBaseLength(e){return Math.pow(this.wholeDistance(e),.99)}wholeDistance(e){for(var t=0,i=0;i<e.length-1;i++)t+=this.distance(e[i],e[i+1]);return t}distance(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}getThirdPoint(e,t,i,r,a){var n=this.getAzimuth(e,t),s=a?n+i:n-i,o=r*Math.cos(s),l=r*Math.sin(s);return[t[0]+o,t[1]+l]}getAzimuth(e,t){var i,r=Math.asin(Math.abs(t[1]-e[1])/this.distance(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=r+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=2*Math.PI-r:t[1]<e[1]&&t[0]<e[0]?i=r:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-r),i}}class et{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.tt=.4,this.identificationPoint=null,this.drawHandler=null,this.GatheringPlace=null,this.GatheringPlaceLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesGatheringPlace=[],this.GatheringPlaceData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}getData(){return this.GatheringPlaceData}computePosition(e){var t=this;if(!(e.length<3)){for(var i=[],r=[],a=t.fineGatheringPlace(e),n=0;n<a.length;n++){var s=new t.Cesium.Cartesian3(a[n].x,a[n].y,a[n].z);i.push(s)}for(let o=0;o<e.length;o++)r.push(t.cartesianToLatlng(e[o]));return this.GatheringPlaceData=r,new t.Cesium.PolygonHierarchy(i)}}addload(e){var t=this;if(!(e.length<3)){for(var i=[],r=[],a=0;a<e.length;a++){var n=t.LatlngTocartesian(e[a]);r.push(n)}for(var s=t.fineGatheringPlace(r),a=0;a<s.length;a++){var o=new t.Cesium.Cartesian3(s[a].x,s[a].y,s[a].z);i.push(o)}var l=new t.Cesium.PolygonHierarchy(i),h=t.viewer.entities.add({Type:"GatheringPlace",Position:e,id:e.id||t.objId,polygon:{hierarchy:l,show:!0,fill:!0,clampToGround:!0,material:t.Cesium.Color.YELLOW.withAlpha(.9)}});return h}}startCreate(e){this.drawType=e;var t=this;this.handler=new t.Cesium.ScreenSpaceEventHandler(t.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=i.position;if(t.Cesium.defined(r)){var a=t.viewer.camera.getPickRay(r);if(t.Cesium.defined(a)){var n=t.viewer.scene.globe.pick(a,t.viewer.scene);t.Cesium.defined(n)&&(t.positions.length==0&&(t.positions.push(n.clone()),t.identificationPoint=t.createPoint(n)),t.positions.length<=2&&(t.createPoint(n),t.positions.push(n)))}}},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<2)){var r=i.endPosition;if(t.Cesium.defined(r)){var a=t.viewer.camera.getPickRay(r);if(t.Cesium.defined(a)){var n=t.viewer.scene.globe.pick(a,t.viewer.scene);t.Cesium.defined(n)&&(t.Cesium.defined(t.GatheringPlace)||(t.GatheringPlace=t.createGatheringPlace()),t.identificationPoint.position.setValue(n),t.GatheringPlace&&(t.positions.length==3?t.positions[1]=n:(t.positions.pop(),t.positions.push(n))))}}}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(t.positions.length>=3){t.GatheringPlaceData=t.positions.concat(),t.viewer.entities.remove(t.GatheringPlace),t.GatheringPlace=null;for(var r=[],a=0;a<t.GatheringPlaceData.length;a++){var n=t.cartesianToLatlng(t.GatheringPlaceData[a]);r.push(n)}t.GatheringPlaceData=r;var s=t.addload(r);t.entitiesGatheringPlace.push(s),t.GatheringPlaceLast=s,t.viewer.entities.remove(t.identificationPoint),t.identificationPoint=null,t.clearPoint(),t.destroy()}},Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createGatheringPlace(){let e=this;var t=e.viewer.entities.add({polygon:{hierarchy:new e.Cesium.CallbackProperty(function(){if(!(e.positions.length<3)){for(var i=[],r=e.fineGatheringPlace(e.positions),a=0;a<r.length;a++){var n=new e.Cesium.Cartesian3(r[a].x,r[a].y,r[a].z);i.push(n)}var s=new e.Cesium.PolygonHierarchy(i),o=e.cartesianToLatlng(e.positions);return s.keyPoints=o,s}},!1),show:!0,fill:!0,clampToGround:!0,material:e.Cesium.Color.fromCssColorString("#ff0").withAlpha(.5)}});return e.entitiesGatheringPlace.push(t),t}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.RED}});return t.entitiesPoint.push(i),i}cartesianToLatlng(e){let t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude),a=t.height;return[r,i,a]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clearPoint(){this.DrawEndEvent.raiseEvent(this.GatheringPlaceLast,this.GatheringPlaceData,this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesGatheringPlace.length;e++)this.viewer.entities.remove(this.entitiesGatheringPlace[e]);this.identificationPoint=null,this.drawHandler=null,this.GatheringPlace=null,this.GatheringPlaceLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesGatheringPlace=[]}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}_computeTempPositions(){var e=this,t=[].concat(e.positions),i=t.length,r=t[0],a=t[i-1];e._isSimpleXYZ(r,a)==!1&&(t.push(r),i+=1),e.tempPositions=[];for(var n=1;n<i;n++){var s=t[n-1],o=t[n],l=e._computeCenterPotition(s,o);e.tempPositions.push(s),e.tempPositions.push(l)}}_isSimpleXYZ(e,t){return e.x==t.x&&e.y==t.y&&e.z==t.z}_computeCenterPotition(e,t){var i=this,r=i.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),a=i.viewer.scene.globe.ellipsoid.cartesianToCartographic(t),n=new i.Cesium.EllipsoidGeodesic(r,a).interpolateUsingFraction(.5),s=i.viewer.scene.globe.ellipsoid.cartographicToCartesian(n);return s}getLonLat(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e);t.height=this.viewer.scene.globe.getHeight(t);var i={lon:t.longitude,lat:t.latitude,alt:t.height};return i.lon=this.Cesium.Math.toDegrees(i.lon),i.lat=this.Cesium.Math.toDegrees(i.lat),i}LatlngTocartesian(e){return this.Cesium.Cartesian3.fromDegrees(e[0],e[1])}fineGatheringPlace(e){let t=this;if(e.length<2)return!1;{let r=new Array;if(e.forEach(function(u){var p=t.getLonLat(u);r.push([p.lon,p.lat])}),r.length===2){let u=t.mid(r[0],r[1]),p=t.distance(r[0],u)/.9,g=t.getThirdPoint(r[0],u,Math.PI/2,p,!0);r=[r[0],g,r[1]]}let a=t.mid(r[0],r[2]);r.push(a,r[0],r[1]);let[n,s,o,l,h]=[[],void 0,void 0,void 0,[]];for(let u=0;u<r.length-2;u++){s=r[u],o=r[u+1],l=r[u+2];let p=t.getBisectorNormals(t.tt,s,o,l);n=n.concat(p)}let c=n.length;n=[n[c-1]].concat(n.slice(0,c-1));for(let u=0;u<r.length-2;u++){s=r[u],o=r[u+1],h=h.concat(s);for(let p=0;p<=100;p++){let g=t.getCubicValue(p/100,s,n[u*2],n[u*2+1],o);h=h.concat(g)}h=h.concat(o)}return Cesium.Cartesian3.fromDegreesArray(h)}}mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}distance(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}getThirdPoint(e,t,i,r,a){var n=this.getAzimuth(e,t),s=a?n+i:n-i,o=r*Math.cos(s),l=r*Math.sin(s);return[t[0]+o,t[1]+l]}getAzimuth(e,t){var i,r=Math.asin(Math.abs(t[1]-e[1])/this.distance(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=r+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=2*Math.PI-r:t[1]<e[1]&&t[0]<e[0]?i=r:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-r),i}getBisectorNormals(e,t,i,r){var a=this.getNormal(t,i,r),n=Math.sqrt(a[0]*a[0]+a[1]*a[1]),s=a[0]/n,o=a[1]/n,l=this.distance(t,i),h=this.distance(i,r);if(n>1e-4)if(this.isClockWise(t,i,r)){var c=e*l,u=i[0]-c*o,p=i[1]+c*s,g=[u,p];c=e*h,u=i[0]+c*o,p=i[1]-c*s;var v=[u,p]}else c=e*l,u=i[0]+c*o,p=i[1]-c*s,g=[u,p],c=e*h,u=i[0]-c*o,p=i[1]+c*s,v=[u,p];else u=i[0]+e*(t[0]-i[0]),p=i[1]+e*(t[1]-i[1]),g=[u,p],u=i[0]+e*(r[0]-i[0]),p=i[1]+e*(r[1]-i[1]),v=[u,p];return[g,v]}getNormal(e,t,i){var r=e[0]-t[0],a=e[1]-t[1],n=Math.sqrt(r*r+a*a);r/=n,a/=n;var s=i[0]-t[0],o=i[1]-t[1],l=Math.sqrt(s*s+o*o);s/=l,o/=l;var h=r+s,c=a+o;return[h,c]}isClockWise(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])}getCubicValue(e,t,i,r,a){e=Math.max(Math.min(e,1),0);var n=1-e,s=e*e,o=s*e,l=n*n,h=l*n,c=h*t[0]+3*l*e*i[0]+3*n*s*r[0]+o*a[0],u=h*t[1]+3*l*e*i[1]+3*n*s*r[1]+o*a[1];return[c,u]}}class it{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.identificationPoint=null,this.Sector=null,this.SectorLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesSector=[],this.SectorData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}getData(){return this.SectorData}computePosition(e){let t=this,i=e,r=t.lonLatToMercator(t.cartesianToLatlng(i[0])),a=t.lonLatToMercator(t.cartesianToLatlng(i[1])),n=t.lonLatToMercator(t.cartesianToLatlng(i[2]));var s=t.MathDistance(a,r),o=t.getAzimuth(a,r),l=t.getAzimuth(n,r),h=t.getArcPoints(r,s,o,l);h.push(i[0],h[0]);let c=[];for(var u=0;u<h.length;u++){var p=new t.Cesium.Cartesian3(h[u].x,h[u].y,h[u].z);c.push(p)}for(var g=[],v=0;v<e.length;v++)g.push(t.cartesianToLatlng(e[v]));return t.SectorData=g,new t.Cesium.PolygonHierarchy(c)}addload(e){var t=this;let i=e,r=t.lonLatToMercator(i[0]),a=t.lonLatToMercator(i[1]),n=t.lonLatToMercator(i[2]);var s=t.MathDistance(a,r),o=t.getAzimuth(a,r),l=t.getAzimuth(n,r),h=t.getArcPoints(r,s,o,l);let c=t.Cesium.Cartesian3.fromDegrees(i[0][0],i[0][1]);h.push(c,h[0]);let u=[];for(var p=0;p<h.length;p++){var g=new t.Cesium.Cartesian3(h[p].x,h[p].y,h[p].z);u.push(g)}var v=t.viewer.entities.add({Type:"DrawSector",Position:e,id:e.id||t.objId,polygon:{hierarchy:new t.Cesium.PolygonHierarchy(u),show:!0,fill:!0,clampToGround:!0,material:t.Cesium.Color.AQUA.withAlpha(.9)}});return v}startCreate(){var e=this;this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(t){var i=e.getCatesian3FromPX(t.position);e.positions.length<3&&(e.identificationPoint=e.createPoint(i),e.positions.push(i)),e.Sector},e.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){if(!(e.positions.length<2)){var i=e.getCatesian3FromPX(t.endPosition);e.positions.length==2&&e.positions.push(i),e.positions.length==3&&(e.positions.pop(),e.positions.push(i),e.Cesium.defined(e.Sector)||(e.Sector=e.createsector()))}},e.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){if(e.Sector){var i=e.getCatesian3FromPX(t.position);e.positions.pop(),e.positions.push(i),e.SectorData=e.positions.concat(),e.viewer.entities.remove(e.Sector),e.Sector=null,e.positions=[],e.identificationPoint.position.setValue(i);for(var r=[],a=0;a<e.SectorData.length;a++){var n=e.cartesianToLatlng(e.SectorData[a]);r.push(n)}e.SectorData=r;var s=e.addload(r);e.entitiesSector.push(s),e.SectorLast=s,e.clearPoint(),e.destroy()}},e.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createsector(){var e=this,t=e.viewer.entities.add({polygon:{hierarchy:new e.Cesium.CallbackProperty(function(){let i=e.positions,r=e.lonLatToMercator(e.cartesianToLatlng(i[0])),a=e.lonLatToMercator(e.cartesianToLatlng(i[1])),n=e.lonLatToMercator(e.cartesianToLatlng(i[2]));var s=e.MathDistance(a,r),o=e.getAzimuth(a,r),l=e.getAzimuth(n,r),h=e.getArcPoints(r,s,o,l);h.push(i[0],h[0]);for(var c=0;c<h.length;c++)new e.Cesium.Cartesian3(h[c].x,h[c].y,h[c].z);return new e.Cesium.PolygonHierarchy(h)},!1),show:!0,fill:!0,clampToGround:!0,material:e.Cesium.Color.AQUA.withAlpha(.5)}});return e.entitiesSector.push(t),t}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.YELLOW}});return t.entitiesPoint.push(i),i}cartesianToLatlng(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return[r,i]}lonLatToMercator(e){var t=e[0],i=e[1],r=t*2003750834e-2/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*2003750834e-2/180,[r,a]}WebMercator2lonLat(e){let t=e[0]/2003750834e-2*180,i=e[1]/2003750834e-2*180,r=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2);return[t,r]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clearPoint(){this.DrawEndEvent.raiseEvent(this.SectorLast,this.SectorData);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesSector.length;e++)this.viewer.entities.remove(this.entitiesSector[e]);this.identificationPoint=null,this.Sector=null,this.SectorLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesSector=[],this.SectorData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}MathDistance(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}getAzimuth(e,t){var i,r=Math.asin(Math.abs(t[1]-e[1])/this.MathDistance(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=r+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=Math.PI*2-r:t[1]<e[1]&&t[0]<e[0]?i=r:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-r),i}getArcPoints(e,t,i,r){var a=null,n=null,s=[],o=r-i;o=o<0?o+Math.PI*2:o;for(var l=0;l<=100;l++){var h=i+o*l/100;a=e[0]+t*Math.cos(h),n=e[1]+t*Math.sin(h);let c=this.WebMercator2lonLat([a,n]);s.push(this.Cesium.Cartesian3.fromDegrees(c[0],c[1]))}return s}}class rt{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.identificationPoint=null,this.ClosedCurve=null,this.ClosedCurveLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesClosedCurve=[],this.ClosedCurveData=null,this.ZERO_TOLERANCE=1e-4,this.FITTING_COUNT=100,this.t=.3,this.objId=+(new Date().getTime()+""+Number(Math.random()*1e3).toFixed(0)),this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}getData(){return this.ClosedCurveData}computePosition(e){let t=this;if(e.length<2)return;let i=[];for(let o=0;o<e.length;o++)i.push(t.cartesianToLatlng(e[o]));this.ClosedCurveData=Array.from(i),i.push(i[0],i[1]);let[r,a]=[[],[]];for(let o=0;o<i.length-2;o++){let l=t.getBisectorNormals(t.t,i[o],i[o+1],i[o+2]);r=r.concat(l)}let n=r.length;r=[r[n-1]].concat(r.slice(0,n-1));for(let o=0;o<i.length-2;o++){let l=i[o],h=i[o+1];a.push(t.LatlngTocartesian(l));for(let c=0;c<=t.FITTING_COUNT;c++){let u=t.getCubicValue(c/t.FITTING_COUNT,l,r[o*2],r[o*2+1],h);a.push(t.LatlngTocartesian(u))}a.push(t.LatlngTocartesian(h))}return{PolygonHierarchy:new t.Cesium.PolygonHierarchy(a),pList:a}}addload(e){let t=this;if(e.length<2)return;let i=Array.from(e);i.push(i[0],i[1]);let[r,a]=[[],[]];for(let o=0;o<i.length-2;o++){let l=t.getBisectorNormals(t.t,i[o],i[o+1],i[o+2]);r=r.concat(l)}let n=r.length;r=[r[n-1]].concat(r.slice(0,n-1));for(let o=0;o<i.length-2;o++){let l=i[o],h=i[o+1];a.push(t.LatlngTocartesian(l));for(let c=0;c<=t.FITTING_COUNT;c++){let u=t.getCubicValue(c/t.FITTING_COUNT,l,r[o*2],r[o*2+1],h);a.push(t.LatlngTocartesian(u))}a.push(t.LatlngTocartesian(h))}console.log(e,i);var s=t.viewer.entities.add({Type:"DrawClosedCurve",Position:e,id:e.id||t.objId,polygon:{hierarchy:new t.Cesium.PolygonHierarchy(a),show:!0,fill:!0,clampToGround:!0,material:t.Cesium.Color.RED.withAlpha(.6)},polyline:{positions:a,show:!0,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW}),width:3,clampToGround:!0}});return s}startCreate(){var e=this;this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(t){var i=e.getCatesian3FromPX(t.position);e.positions.length==0&&(e.identificationPoint=e.createPoint(i)),e.positions.push(i),e.createPoint(i)},e.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){if(!(e.positions.length<2)){var i=e.getCatesian3FromPX(t.endPosition);e.positions.length==2&&e.positions.push(i),e.positions.pop(),e.positions.push(i),e.Cesium.defined(e.ClosedCurve)||(e.ClosedCurve=e.createClosedCurve())}},e.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){if(e.ClosedCurve){var i=e.getCatesian3FromPX(t.position);e.positions.pop(),e.positions.push(i),e.ClosedCurveData=e.positions.concat(),e.viewer.entities.remove(e.ClosedCurve),e.ClosedCurve=null,e.positions=[],e.identificationPoint.position.setValue(i);for(var r=[],a=0;a<e.ClosedCurveData.length;a++){var n=e.cartesianToLatlng(e.ClosedCurveData[a]);r.push(n)}e.ClosedCurveData=r;var s=e.addload(r);e.entitiesClosedCurve.push(s),e.ClosedCurveLast=s,e.clearPoint(),e.destroy()}},e.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createClosedCurve(){var e=this;e.pLists="";var t=e.viewer.entities.add({polygon:{hierarchy:new e.Cesium.CallbackProperty(function(){if(e.positions.length<2)return;let i=[];for(let s=0;s<e.positions.length;s++)i.push(e.cartesianToLatlng(e.positions[s]));i.push(i[0],i[1]);let[r,a]=[[],[]];for(let s=0;s<i.length-2;s++){let o=e.getBisectorNormals(e.t,i[s],i[s+1],i[s+2]);r=r.concat(o)}let n=r.length;r=[r[n-1]].concat(r.slice(0,n-1));for(let s=0;s<i.length-2;s++){let o=i[s],l=i[s+1];a.push(e.LatlngTocartesian(o));for(let h=0;h<=e.FITTING_COUNT;h++){let c=e.getCubicValue(h/e.FITTING_COUNT,o,r[s*2],r[s*2+1],l);a.push(e.LatlngTocartesian(c))}a.push(e.LatlngTocartesian(l))}return e.pLists=a,new e.Cesium.PolygonHierarchy(a)},!1),show:!0,fill:!0,clampToGround:!0,material:e.Cesium.Color.RED.withAlpha(.6)},polyline:{positions:new e.Cesium.CallbackProperty(function(){return e.pLists},!1),show:!0,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW}),width:3,clampToGround:!0}});return e.entitiesClosedCurve.push(t),t}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.YELLOW}});return t.entitiesPoint.push(i),i}cartesianToLatlng(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return[r,i]}LatlngTocartesian(e){return this.Cesium.Cartesian3.fromDegrees(e[0],e[1])}lonLatToMercator(e){var t=e[0],i=e[1],r=t*2003750834e-2/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*2003750834e-2/180,[r,a]}WebMercator2lonLat(e){let t=e[0]/2003750834e-2*180,i=e[1]/2003750834e-2*180,r=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2);return[t,r]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clearPoint(){this.DrawEndEvent.raiseEvent(this.ClosedCurveLast,this.ClosedCurveData);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesClosedCurve.length;e++)this.viewer.entities.remove(this.entitiesClosedCurve[e]);this.identificationPoint=null,this.ClosedCurve=null,this.ClosedCurveLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesClosedCurve=[],this.ClosedCurveData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}getBisectorNormals(e,t,i,r){let a=this,n=a.getNormal(t,i,r),[s,o,l,h,c]=[null,null,null,null,null],u=Math.sqrt(n[0]*n[0]+n[1]*n[1]),p=n[0]/u,g=n[1]/u,v=a.MathDistance(t,i),d=a.MathDistance(i,r);return u>a.ZERO_TOLERANCE?a.isClockWise(t,i,r)?(l=e*v,h=i[0]-l*g,c=i[1]+l*p,s=[h,c],l=e*d,h=i[0]+l*g,c=i[1]-l*p,o=[h,c]):(l=e*v,h=i[0]+l*g,c=i[1]-l*p,s=[h,c],l=e*d,h=i[0]-l*g,c=i[1]+l*p,o=[h,c]):(h=i[0]+e*(t[0]-i[0]),c=i[1]+e*(t[1]-i[1]),s=[h,c],h=i[0]+e*(r[0]-i[0]),c=i[1]+e*(r[1]-i[1]),o=[h,c]),[s,o]}getNormal(e,t,i){let r=e[0]-t[0],a=e[1]-t[1],n=Math.sqrt(r*r+a*a);r/=n,a/=n;let s=i[0]-t[0],o=i[1]-t[1],l=Math.sqrt(s*s+o*o);s/=l,o/=l;let h=r+s,c=a+o;return[h,c]}MathDistance(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}isClockWise(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])}getCubicValue(e,t,i,r,a){e=Math.max(Math.min(e,1),0);let[n,s]=[1-e,e*e],o=s*e,l=n*n,h=l*n,c=h*t[0]+3*l*e*i[0]+3*n*s*r[0]+o*a[0],u=h*t[1]+3*l*e*i[1]+3*n*s*r[1]+o*a[1];return[c,u]}}class nt{constructor(e){this.objId=+(new Date().getTime()+""+Number(Math.random()*1e3).toFixed(0)),this.viewer=e.viewer,this.Cesium=e.Cesium,this.tt=.4,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event,this.identificationPoint=null,this.drawHandler=null,this.DrawArc=null,this.DrawArcLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesArc=[],this._DrawArcData=null}getData(){return this._DrawArcData}computePosition(e){var t=this;if(e.length<3)return;var i=[];let r=[];for(var a=0;a<e.length;a++){r.push(t.cartesianToLatlng(e[a]));var n=t.lonLatToMercator(t.cartesianToLatlng(e[a]));i.push(n)}let[s,o,l,h,c]=[i[0],i[2],i[1],null,null],u=t.getCircleCenterOfThreePoints(s,o,l),p=t.MathDistance(s,u),g=t.getAzimuth(s,u),v=t.getAzimuth(o,u);t.isClockWise(s,o,l)?(h=v,c=g):(h=g,c=v);let d=t.getArcPoints(u,p,h,c),w=[];for(var m=0;m<d.length;m++){var n=t.LatlngTocartesian(t.WebMercator2lonLat(d[m]));w.push(n)}return t._DrawArcData=r,w}addload(e){var t=this;if(e.length<3)return;for(var i=[],r=0;r<e.length;r++){var a=t.lonLatToMercator(e[r]);i.push(a)}let[n,s,o,l,h]=[i[0],i[2],i[1],null,null],c=t.getCircleCenterOfThreePoints(n,s,o),u=t.MathDistance(n,c),p=t.getAzimuth(n,c),g=t.getAzimuth(s,c);t.isClockWise(n,s,o)?(l=g,h=p):(l=p,h=g);let v=t.getArcPoints(c,u,l,h),d=[];for(var w=0;w<v.length;w++){var a=t.LatlngTocartesian(t.WebMercator2lonLat(v[w]));d.push(a)}var m=t.viewer.entities.add({Type:"DrawArc",Position:e,id:e.id||t.objId,polyline:{positions:d,show:!0,material:t.Cesium.Color.YELLOW,width:3,clampToGround:!0}});return m}startCreate(e){this.drawType=e;var t=this;this.handler=new t.Cesium.ScreenSpaceEventHandler(t.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=i.position;if(t.Cesium.defined(r)){var a=t.viewer.camera.getPickRay(r);if(t.Cesium.defined(a)){var n=t.viewer.scene.globe.pick(a,t.viewer.scene);t.Cesium.defined(n)&&(t.positions.length==0&&(t.positions.push(n.clone()),t.identificationPoint=t.createPoint(n)),t.positions.length<=2&&(t.createPoint(n),t.positions.push(n)))}}},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<2)){var r=i.endPosition;if(t.Cesium.defined(r)){var a=t.viewer.camera.getPickRay(r);if(t.Cesium.defined(a)){var n=t.viewer.scene.globe.pick(a,t.viewer.scene);t.Cesium.defined(n)&&(t.Cesium.defined(t.DrawArc)||(t.DrawArc=t.createDrawArc()),t.identificationPoint.position.setValue(n),t.DrawArc&&(t.positions.length==3?t.positions[1]=n:(t.positions.pop(),t.positions.push(n))))}}}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(t.positions.length>=3){t._DrawArcData=t.positions.concat(),t.viewer.entities.remove(t.DrawArc),t.DrawArc=null;for(var r=[],a=0;a<t._DrawArcData.length;a++){var n=t.cartesianToLatlng(t._DrawArcData[a]);r.push(n)}t._DrawArcData=r;var s=t.addload(r);t.entitiesArc.push(s),t.DrawArcLast=s,t.viewer.entities.remove(t.identificationPoint),t.identificationPoint=null,t.clearPoint(),t.destroy()}},Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createDrawArc(){let e=this;var t=e.viewer.entities.add({polyline:{positions:new e.Cesium.CallbackProperty(function(){if(e.positions.length<3)return;for(var i=[],r=0;r<e.positions.length;r++){var a=e.lonLatToMercator(e.cartesianToLatlng(e.positions[r]));i.push(a)}let[n,s,o,l,h]=[i[0],i[2],i[1],null,null],c=e.getCircleCenterOfThreePoints(n,s,o),u=e.MathDistance(n,c),p=e.getAzimuth(n,c),g=e.getAzimuth(s,c);e.isClockWise(n,s,o)?(l=g,h=p):(l=p,h=g);let v=e.getArcPoints(c,u,l,h),d=[];for(var w=0;w<v.length;w++){var a=e.LatlngTocartesian(e.WebMercator2lonLat(v[w]));d.push(a)}return d},!1),show:!0,material:e.Cesium.Color.YELLOW,width:3,clampToGround:!0}});return e.entitiesArc.push(t),t}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.RED}});return t.entitiesPoint.push(i),i}cartesianToLatlng(e){let t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return t.height,[r,i]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clearPoint(){this.DrawEndEvent.raiseEvent(this.DrawArcLast,this._DrawArcData,this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesArc.length;e++)this.viewer.entities.remove(this.entitiesArc[e]);this.identificationPoint=null,this.drawHandler=null,this.DrawArc=null,this.DrawArcLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesArc=[],this._DrawArcData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}_computeTempPositions(){var e=this,t=[].concat(e.positions),i=t.length,r=t[0],a=t[i-1];e._isSimpleXYZ(r,a)==!1&&(t.push(r),i+=1),e.tempPositions=[];for(var n=1;n<i;n++){var s=t[n-1],o=t[n],l=e._computeCenterPotition(s,o);e.tempPositions.push(s),e.tempPositions.push(l)}}_isSimpleXYZ(e,t){return e.x==t.x&&e.y==t.y&&e.z==t.z}_computeCenterPotition(e,t){var i=this,r=i.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),a=i.viewer.scene.globe.ellipsoid.cartesianToCartographic(t),n=new i.Cesium.EllipsoidGeodesic(r,a).interpolateUsingFraction(.5),s=i.viewer.scene.globe.ellipsoid.cartographicToCartesian(n);return s}getLonLat(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e);t.height=this.viewer.scene.globe.getHeight(t);var i={lon:t.longitude,lat:t.latitude,alt:t.height};return i.lon=this.Cesium.Math.toDegrees(i.lon),i.lat=this.Cesium.Math.toDegrees(i.lat),i}LatlngTocartesian(e){return this.Cesium.Cartesian3.fromDegrees(e[0],e[1])}lonLatToMercator(e){var t=e[0],i=e[1],r=t*2003750834e-2/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*2003750834e-2/180,[r,a]}WebMercator2lonLat(e){let t=e[0]/2003750834e-2*180,i=e[1]/2003750834e-2*180,r=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2);return[t,r]}getCircleCenterOfThreePoints(e,t,i){let r=[(e[0]+t[0])/2,(e[1]+t[1])/2],a=[r[0]-e[1]+t[1],r[1]+e[0]-t[0]],n=[(e[0]+i[0])/2,(e[1]+i[1])/2],s=[n[0]-e[1]+i[1],n[1]+e[0]-i[0]];return this.getIntersectPoint(r,a,n,s)}getIntersectPoint(e,t,i,r){if(e[1]===t[1]){let h=(r[0]-i[0])/(r[1]-i[1])*(e[1]-i[1])+i[0],c=e[1];return[h,c]}if(i[1]===r[1]){let h=(t[0]-e[0])/(t[1]-e[1])*(i[1]-e[1])+e[0],c=i[1];return[h,c]}let a=(t[0]-e[0])/(t[1]-e[1]),n=(r[0]-i[0])/(r[1]-i[1]),s=(a*e[1]-e[0]-n*i[1]+i[0])/(a-n);return[a*s-a*e[1]+e[0],s]}MathDistance(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}getAzimuth(e,t){let i,r=Math.asin(Math.abs(t[1]-e[1])/this.MathDistance(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=r+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=Math.PI*2-r:t[1]<e[1]&&t[0]<e[0]?i=r:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-r),i}isClockWise(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])}getArcPoints(e,t,i,r){let[a,n,s,o]=[null,null,[],r-i];o=o<0?o+Math.PI*2:o;for(let l=0;l<=100;l++){let h=i+o*l/100;a=e[0]+t*Math.cos(h),n=e[1]+t*Math.sin(h),s.push([a,n])}return s}}class at{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.tt=.4,this.identificationPoint=null,this.drawHandler=null,this.DrawLune=null,this.DrawLuneLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesPincerArrow=[],this.DrawLuneData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}getData(){return this.DrawLuneData}computePosition(e){var t=this;if(e.length<3)return;var i=[];let r=[];for(var a=0;a<e.length;a++){r.push(t.cartesianToLatlng(e[a]));var n=t.lonLatToMercator(t.cartesianToLatlng(e[a]));i.push(n)}let[s,o,l,h,c]=[i[0],i[2],i[1],null,null],u=t.getCircleCenterOfThreePoints(s,o,l),p=t.MathDistance(s,u),g=t.getAzimuth(s,u),v=t.getAzimuth(o,u);t.isClockWise(s,o,l)?(h=v,c=g):(h=g,c=v);let d=t.getArcPoints(u,p,h,c),w=[];for(var m=0;m<d.length;m++){var n=t.LatlngTocartesian(t.WebMercator2lonLat(d[m]));w.push(n)}return w.push(w[0]),t.DrawLuneData=r,new t.Cesium.PolygonHierarchy(w)}addload(e){var t=this;if(e.length<3)return;for(var i=[],r=0;r<e.length;r++){var a=t.lonLatToMercator(e[r]);i.push(a)}let[n,s,o,l,h]=[i[0],i[2],i[1],null,null],c=t.getCircleCenterOfThreePoints(n,s,o),u=t.MathDistance(n,c),p=t.getAzimuth(n,c),g=t.getAzimuth(s,c);t.isClockWise(n,s,o)?(l=g,h=p):(l=p,h=g);let v=t.getArcPoints(c,u,l,h),d=[];for(var w=0;w<v.length;w++){var a=t.LatlngTocartesian(t.WebMercator2lonLat(v[w]));d.push(a)}d.push(d[0]);var m=t.viewer.entities.add({Type:"DrawLune",Position:e,id:e.id||t.objId,polygon:{hierarchy:new t.Cesium.PolygonHierarchy(d),show:!0,material:t.Cesium.Color.RED.withAlpha(.6),width:3,clampToGround:!0,outlineWidth:3,outline:!0,outlineColor:Cesium.Color.MAGENTA}});return m}startCreate(e){this.drawType=e;var t=this;this.handler=new t.Cesium.ScreenSpaceEventHandler(t.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=i.position;if(t.Cesium.defined(r)){var a=t.viewer.camera.getPickRay(r);if(t.Cesium.defined(a)){var n=t.viewer.scene.globe.pick(a,t.viewer.scene);t.Cesium.defined(n)&&(t.positions.length==0&&(t.positions.push(n.clone()),t.identificationPoint=t.createPoint(n)),t.positions.length<3&&(t.createPoint(n),t.positions.push(n)))}}},Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<3)){var r=i.endPosition;if(t.Cesium.defined(r)){var a=t.viewer.camera.getPickRay(r);if(t.Cesium.defined(a)){var n=t.viewer.scene.globe.pick(a,t.viewer.scene);t.Cesium.defined(n)&&(t.Cesium.defined(t.DrawLune)||(t.DrawLune=t.createDrawLune()),t.identificationPoint.position.setValue(n),t.DrawLune&&(t.positions.length==3?t.positions[1]=n:(t.positions.pop(),t.positions.push(n))))}}}},Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(t.positions.length>=3){t.DrawLuneData=t.positions.concat(),t.viewer.entities.remove(t.DrawLune),t.DrawLune=null;for(var r=[],a=0;a<t.DrawLuneData.length;a++){var n=t.cartesianToLatlng(t.DrawLuneData[a]);r.push(n)}t.DrawLuneData=r;var s=t.addload(r);t.entitiesPincerArrow.push(s),t.DrawLuneLast=s,t.viewer.entities.remove(t.identificationPoint),t.identificationPoint=null,t.clearPoint(),t.destroy()}},Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createDrawLune(){let e=this;var t=e.viewer.entities.add({polygon:{hierarchy:new e.Cesium.CallbackProperty(function(){if(e.positions.length<3)return;for(var i=[],r=0;r<e.positions.length;r++){var a=e.lonLatToMercator(e.cartesianToLatlng(e.positions[r]));i.push(a)}let[n,s,o,l,h]=[i[0],i[2],i[1],null,null],c=e.getCircleCenterOfThreePoints(n,s,o),u=e.MathDistance(n,c),p=e.getAzimuth(n,c),g=e.getAzimuth(s,c);e.isClockWise(n,s,o)?(l=g,h=p):(l=p,h=g);let v=e.getArcPoints(c,u,l,h),d=[];for(var w=0;w<v.length;w++){var a=e.LatlngTocartesian(e.WebMercator2lonLat(v[w]));d.push(a)}return d.push(d[0]),new e.Cesium.PolygonHierarchy(d)},!1),show:!0,material:e.Cesium.Color.RED.withAlpha(.6),clampToGround:!0}});return e.entitiesPincerArrow.push(t),t}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.RED}});return t.entitiesPoint.push(i),i}cartesianToLatlng(e){let t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return t.height,[r,i]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clearPoint(){this.DrawEndEvent.raiseEvent(this.DrawLuneLast,this.DrawLuneData,this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesPincerArrow.length;e++)this.viewer.entities.remove(this.entitiesPincerArrow[e]);this.identificationPoint=null,this.drawHandler=null,this.DrawLune=null,this.DrawLuneLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesPincerArrow=[],this.DrawLuneData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}_computeTempPositions(){var e=this,t=[].concat(e.positions),i=t.length,r=t[0],a=t[i-1];e._isSimpleXYZ(r,a)==!1&&(t.push(r),i+=1),e.tempPositions=[];for(var n=1;n<i;n++){var s=t[n-1],o=t[n],l=e._computeCenterPotition(s,o);e.tempPositions.push(s),e.tempPositions.push(l)}}_isSimpleXYZ(e,t){return e.x==t.x&&e.y==t.y&&e.z==t.z}_computeCenterPotition(e,t){var i=this,r=i.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),a=i.viewer.scene.globe.ellipsoid.cartesianToCartographic(t),n=new i.Cesium.EllipsoidGeodesic(r,a).interpolateUsingFraction(.5),s=i.viewer.scene.globe.ellipsoid.cartographicToCartesian(n);return s}getLonLat(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e);t.height=this.viewer.scene.globe.getHeight(t);var i={lon:t.longitude,lat:t.latitude,alt:t.height};return i.lon=this.Cesium.Math.toDegrees(i.lon),i.lat=this.Cesium.Math.toDegrees(i.lat),i}LatlngTocartesian(e){return this.Cesium.Cartesian3.fromDegrees(e[0],e[1])}lonLatToMercator(e){var t=e[0],i=e[1],r=t*2003750834e-2/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*2003750834e-2/180,[r,a]}WebMercator2lonLat(e){let t=e[0]/2003750834e-2*180,i=e[1]/2003750834e-2*180,r=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2);return[t,r]}getCircleCenterOfThreePoints(e,t,i){let r=[(e[0]+t[0])/2,(e[1]+t[1])/2],a=[r[0]-e[1]+t[1],r[1]+e[0]-t[0]],n=[(e[0]+i[0])/2,(e[1]+i[1])/2],s=[n[0]-e[1]+i[1],n[1]+e[0]-i[0]];return this.getIntersectPoint(r,a,n,s)}getIntersectPoint(e,t,i,r){if(e[1]===t[1]){let h=(r[0]-i[0])/(r[1]-i[1])*(e[1]-i[1])+i[0],c=e[1];return[h,c]}if(i[1]===r[1]){let h=(t[0]-e[0])/(t[1]-e[1])*(i[1]-e[1])+e[0],c=i[1];return[h,c]}let a=(t[0]-e[0])/(t[1]-e[1]),n=(r[0]-i[0])/(r[1]-i[1]),s=(a*e[1]-e[0]-n*i[1]+i[0])/(a-n);return[a*s-a*e[1]+e[0],s]}MathDistance(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}getAzimuth(e,t){let i,r=Math.asin(Math.abs(t[1]-e[1])/this.MathDistance(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=r+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=Math.PI*2-r:t[1]<e[1]&&t[0]<e[0]?i=r:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-r),i}isClockWise(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])}getArcPoints(e,t,i,r){let[a,n,s,o]=[null,null,[],r-i];o=o<0?o+Math.PI*2:o;for(let l=0;l<=100;l++){let h=i+o*l/100;a=e[0]+t*Math.cos(h),n=e[1]+t*Math.sin(h),s.push([a,n])}return s}}class st{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.identificationPoint=null,this.RectFlag=null,this.RectFlagLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesRectFlag=[],this.RectFlagData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}getData(){return this.RectFlagData}computePosition(e){let t=this;for(var i=[],r=0;r<e.length;r++){var a=t.cartesianToLatlng(e[r]);i.push(a)}let n=i[0],s=i[i.length-1],o=i[0];var l=[s[0],n[1]],h=[s[0],(n[1]+s[1])/2],c=[n[0],(n[1]+s[1])/2],u=[n[0],s[1]];let p=t.Cesium.Cartesian3.fromDegreesArray([...o,...l,...h,...c,...o]),g=t.Cesium.Cartesian3.fromDegreesArray([...o,...l,...h,...c,...o,...u]),v=new t.Cesium.PolygonHierarchy(p);return t.RectFlagData=i,console.log([v,g]),[v,g]}addload(e){var t=this;if(e.length<2)return;let i=e[0],r=e[e.length-1],a=e[0];var n=[r[0],i[1]],s=[r[0],(i[1]+r[1])/2],o=[i[0],(i[1]+r[1])/2],l=[i[0],r[1]];let h=t.Cesium.Cartesian3.fromDegreesArray([...a,...n,...s,...o,...a]),c=t.Cesium.Cartesian3.fromDegreesArray([...a,...n,...s,...o,...a,...l]);var u=this.viewer.entities.add({Type:"DrawRectFlag",Position:e,id:e.id||t.objId,polygon:{hierarchy:new t.Cesium.PolygonHierarchy(h),extrudedHeight:1,material:Cesium.Color.RED.withAlpha(.6)},polyline:{positions:c,show:!0,material:t.Cesium.Color.YELLOW,width:5,clampToGround:!0}});return t.entitiesRectFlag.push(u),u}startCreate(e){this.drawType=e;var t=this;this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);t.positions.length==0&&(t.positions.push(r.clone()),t.identificationPoint=t.createPoint(r),t.createPoint(r),t.positions.push(r))},t.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<2)){var r=t.getCatesian3FromPX(i.endPosition);t.Cesium.defined(t.RectFlag)||(t.RectFlag=t.createRectFlag()),t.identificationPoint.position.setValue(r),t.RectFlag&&(t.positions.pop(),t.positions.push(r))}},t.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(t.RectFlag){var r=t.getCatesian3FromPX(i.position);t.positions.pop(),t.positions.push(r),t.createPoint(r),t.RectFlagData=t.positions.concat(),t.viewer.entities.remove(t.RectFlag),t.RectFlag=null,t.positions=[],t.identificationPoint.position.setValue(r);for(var a=[],n=0;n<t.RectFlagData.length;n++){var s=t.cartesianToLatlng(t.RectFlagData[n]);a.push(s)}t.RectFlagData=a;var o=t.addload([t.RectFlagData[0],t.RectFlagData[t.RectFlagData.length-1]]);t.entitiesRectFlag.push(o),t.RectFlagLast=o,t.clearPoint(),t.destroy()}},t.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.YELLOW}});return t.entitiesPoint.push(i),i}createRectFlag(){console.log("232323");var e=this,t=this.viewer.entities.add({polygon:{hierarchy:new e.Cesium.CallbackProperty(function(){if(e.positions.length<2)return;let i=[],r=e.positions.length;for(let u=0;u<r;u++)i.push(e.cartesianToLatlng(e.positions[u]));let a=i[0],n=i[i.length-1],s=i[0];var o=[n[0],a[1]],l=[n[0],(a[1]+n[1])/2],h=[a[0],(a[1]+n[1])/2];a[0],n[1];let c=e.Cesium.Cartesian3.fromDegreesArray([...s,...o,...l,...h,...s]);return new e.Cesium.PolygonHierarchy(c)},!1),extrudedHeight:1,material:Cesium.Color.RED.withAlpha(.6)},polyline:{positions:new e.Cesium.CallbackProperty(function(){if(e.positions.length<2)return;let i=[],r=e.positions.length;for(let p=0;p<r;p++)i.push(e.cartesianToLatlng(e.positions[p]));let a=i[0],n=i[i.length-1],s=i[0];var o=[n[0],a[1]],l=[n[0],(a[1]+n[1])/2],h=[a[0],(a[1]+n[1])/2],c=[a[0],n[1]];return e.Cesium.Cartesian3.fromDegreesArray([...s,...o,...l,...h,...s,...c])},!1),show:!0,material:e.Cesium.Color.YELLOW,width:5,clampToGround:!0}});return e.entitiesRectFlag.push(t),t}cartesianToLatlng(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return[r,i]}LatlngTocartesian(e){return this.Cesium.Cartesian3.fromDegrees(e[0],e[1])}clearPoint(){this.DrawEndEvent.raiseEvent(this.RectFlagLast,[this.RectFlagData[0],this.RectFlagData[this.RectFlagData.length-1]],this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesRectFlag.length;e++)this.viewer.entities.remove(this.entitiesRectFlag[e]);this.identificationPoint=null,this.RectFlag=null,this.RectFlagLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesRectFlag=[],this.RectFlagData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}}class ot{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.identificationPoint=null,this.TriangleFlag=null,this.TriangleFlagLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesTriangleFlag=[],this.TriangleFlagData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}getData(){return this.TriangleFlagData}computePosition(e){let t=this;for(var i=[],r=0;r<e.length;r++){var a=t.cartesianToLatlng(e[r]);i.push(a)}let n=i[0],s=i[i.length-1],o=i[0];var l=[s[0],(n[1]+s[1])/2],h=[n[0],(n[1]+s[1])/2],c=[n[0],s[1]];let u=t.Cesium.Cartesian3.fromDegreesArray([...o,...l,...h,...o]),p=t.Cesium.Cartesian3.fromDegreesArray([...o,...l,...h,...o,...c]),g=new t.Cesium.PolygonHierarchy(u);return t.TriangleFlagData=i,console.log([g,p]),[g,p]}addload(e){var t=this;if(e.length<2)return;let i=e[0],r=e[e.length-1],a=e[0];var n=[r[0],(i[1]+r[1])/2],s=[i[0],(i[1]+r[1])/2],o=[i[0],r[1]];let l=t.Cesium.Cartesian3.fromDegreesArray([...a,...n,...s,...a]),h=t.Cesium.Cartesian3.fromDegreesArray([...a,...n,...s,...a,...o]);var c=this.viewer.entities.add({Type:"DrawTriangleFlag",Position:e,id:e.id||t.objId,polygon:{hierarchy:new t.Cesium.PolygonHierarchy(l),extrudedHeight:1,material:Cesium.Color.RED.withAlpha(.6)},polyline:{positions:h,show:!0,material:t.Cesium.Color.YELLOW,width:5,clampToGround:!0}});return t.entitiesTriangleFlag.push(c),c}startCreate(e){this.drawType=e;var t=this;this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);t.positions.length==0&&(t.positions.push(r.clone()),t.identificationPoint=t.createPoint(r),t.createPoint(r),t.positions.push(r))},t.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<2)){var r=t.getCatesian3FromPX(i.endPosition);t.Cesium.defined(t.TriangleFlag)||(t.TriangleFlag=t.createTriangleFlag()),t.identificationPoint.position.setValue(r),t.TriangleFlag&&(t.positions.pop(),t.positions.push(r))}},t.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(t.TriangleFlag){var r=t.getCatesian3FromPX(i.position);t.positions.pop(),t.positions.push(r),t.createPoint(r),t.TriangleFlagData=t.positions.concat(),t.viewer.entities.remove(t.TriangleFlag),t.TriangleFlag=null,t.positions=[],t.identificationPoint.position.setValue(r);for(var a=[],n=0;n<t.TriangleFlagData.length;n++){var s=t.cartesianToLatlng(t.TriangleFlagData[n]);a.push(s)}t.TriangleFlagData=a;var o=t.addload([t.TriangleFlagData[0],t.TriangleFlagData[t.TriangleFlagData.length-1]]);t.entitiesTriangleFlag.push(o),t.TriangleFlagLast=o,t.clearPoint(),t.destroy()}},t.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.YELLOW}});return t.entitiesPoint.push(i),i}createTriangleFlag(){console.log("232323");var e=this,t=this.viewer.entities.add({polygon:{hierarchy:new e.Cesium.CallbackProperty(function(){if(e.positions.length<2)return;let i=[],r=e.positions.length;for(let c=0;c<r;c++)i.push(e.cartesianToLatlng(e.positions[c]));let a=i[0],n=i[i.length-1],s=i[0];var o=[n[0],(a[1]+n[1])/2],l=[a[0],(a[1]+n[1])/2];a[0],n[1];let h=e.Cesium.Cartesian3.fromDegreesArray([...s,...o,...l,...s]);return new e.Cesium.PolygonHierarchy(h)},!1),extrudedHeight:1,material:Cesium.Color.RED.withAlpha(.6)},polyline:{positions:new e.Cesium.CallbackProperty(function(){if(e.positions.length<2)return;let i=[],r=e.positions.length;for(let u=0;u<r;u++)i.push(e.cartesianToLatlng(e.positions[u]));let a=i[0],n=i[i.length-1],s=i[0];var o=[n[0],(a[1]+n[1])/2],l=[a[0],(a[1]+n[1])/2],h=[a[0],n[1]];return e.Cesium.Cartesian3.fromDegreesArray([...s,...o,...l,...s,...h])},!1),show:!0,material:e.Cesium.Color.YELLOW,width:5,clampToGround:!0}});return e.entitiesTriangleFlag.push(t),t}cartesianToLatlng(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return[r,i]}LatlngTocartesian(e){return this.Cesium.Cartesian3.fromDegrees(e[0],e[1])}clearPoint(){this.DrawEndEvent.raiseEvent(this.TriangleFlagLast,[this.TriangleFlagData[0],this.TriangleFlagData[this.TriangleFlagData.length-1]],this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesTriangleFlag.length;e++)this.viewer.entities.remove(this.entitiesTriangleFlag[e]);this.identificationPoint=null,this.TriangleFlag=null,this.TriangleFlagLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesTriangleFlag=[],this.TriangleFlagData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}}class lt{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.identificationPoint=null,this.CurveFlag=null,this.CurveFlagLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesCurveFlag=[],this.CurveFlagData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}getData(){return this.CurveFlagData}computePosition(e){let t=this;for(var i=[],r=0;r<e.length;r++){var a=t.cartesianToLatlng(e[r]);i.push(a)}let n=i[0],s=i[i.length-1],o=n,l=[(s[0]-n[0])/4+n[0],(s[1]-n[1])/8+n[1]],h=[(n[0]+s[0])/2,n[1]],c=[(s[0]-n[0])*3/4+n[0],-(s[1]-n[1])/8+n[1]],u=[s[0],n[1]],p=[s[0],(n[1]+s[1])/2],g=[(s[0]-n[0])*3/4+n[0],(s[1]-n[1])*3/8+n[1]],v=[(n[0]+s[0])/2,(n[1]+s[1])/2],d=[(s[0]-n[0])/4+n[0],(s[1]-n[1])*5/8+n[1]],w=[n[0],(n[1]+s[1])/2],m=[n[0],s[1]],C=t.getBezierPoints([o,l,h,c,u]),f=t.getBezierPoints([p,g,v,d,w]),y=[];y=C.concat(f);let D=new t.Cesium.PolygonHierarchy(y),E=[];return E=C.concat(f),E.push(t.LatlngTocartesian(o)),E.push(t.LatlngTocartesian(m)),t.CurveFlagData=i,[D,E]}addload(e){var t=this;if(e.length<2)return;let i=e[0],r=e[e.length-1],a=i,n=[(r[0]-i[0])/4+i[0],(r[1]-i[1])/8+i[1]],s=[(i[0]+r[0])/2,i[1]],o=[(r[0]-i[0])*3/4+i[0],-(r[1]-i[1])/8+i[1]],l=[r[0],i[1]],h=[r[0],(i[1]+r[1])/2],c=[(r[0]-i[0])*3/4+i[0],(r[1]-i[1])*3/8+i[1]],u=[(i[0]+r[0])/2,(i[1]+r[1])/2],p=[(r[0]-i[0])/4+i[0],(r[1]-i[1])*5/8+i[1]],g=[i[0],(i[1]+r[1])/2],v=[i[0],r[1]],d=t.getBezierPoints([a,n,s,o,l]),w=t.getBezierPoints([h,c,u,p,g]),m=[];m=d.concat(w);let C=[];C=d.concat(w),C.push(t.LatlngTocartesian(a)),C.push(t.LatlngTocartesian(v));var f=this.viewer.entities.add({Type:"DrawCurveFlag",Position:e,id:e.id||t.objId,polygon:{hierarchy:new t.Cesium.PolygonHierarchy(m),extrudedHeight:1,material:t.Cesium.Color.RED.withAlpha(.6)},polyline:{positions:C,show:!0,material:t.Cesium.Color.YELLOW,width:5,clampToGround:!0}});return t.entitiesCurveFlag.push(f),f}startCreate(e){this.drawType=e;var t=this;this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);t.positions.length==0&&(t.positions.push(r.clone()),t.identificationPoint=t.createPoint(r),t.createPoint(r),t.positions.push(r))},t.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<2)){var r=t.getCatesian3FromPX(i.endPosition);t.Cesium.defined(t.CurveFlag)||(t.CurveFlag=t.createCurveFlag()),t.identificationPoint.position.setValue(r),t.CurveFlag&&(t.positions.pop(),t.positions.push(r))}},t.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(t.CurveFlag){var r=t.getCatesian3FromPX(i.position);t.positions.pop(),t.positions.push(r),t.createPoint(r),t.CurveFlagData=t.positions.concat(),t.viewer.entities.remove(t.CurveFlag),t.CurveFlag=null,t.positions=[],t.identificationPoint.position.setValue(r);for(var a=[],n=0;n<t.CurveFlagData.length;n++){var s=t.cartesianToLatlng(t.CurveFlagData[n]);a.push(s)}t.CurveFlagData=a;var o=t.addload([t.CurveFlagData[0],t.CurveFlagData[t.CurveFlagData.length-1]]);t.entitiesCurveFlag.push(o),t.CurveFlagLast=o,t.clearPoint(),t.destroy()}},t.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.YELLOW}});return t.entitiesPoint.push(i),i}createCurveFlag(){var e=this,t=this.viewer.entities.add({polygon:{hierarchy:new e.Cesium.CallbackProperty(function(){if(e.positions.length<2)return;let i=[],r=[],a=e.positions.length;for(let f=0;f<a;f++)i.push(e.cartesianToLatlng(e.positions[f]));let n=i[0],s=i[i.length-1],o=n,l=[(s[0]-n[0])/4+n[0],(s[1]-n[1])/8+n[1]],h=[(n[0]+s[0])/2,n[1]],c=[(s[0]-n[0])*3/4+n[0],-(s[1]-n[1])/8+n[1]],u=[s[0],n[1]],p=[s[0],(n[1]+s[1])/2],g=[(s[0]-n[0])*3/4+n[0],(s[1]-n[1])*3/8+n[1]],v=[(n[0]+s[0])/2,(n[1]+s[1])/2],d=[(s[0]-n[0])/4+n[0],(s[1]-n[1])*5/8+n[1]],w=[n[0],(n[1]+s[1])/2];n[0],s[1];let m=e.getBezierPoints([o,l,h,c,u]),C=e.getBezierPoints([p,g,v,d,w]);return r=m.concat(C),new e.Cesium.PolygonHierarchy(r)},!1),extrudedHeight:1,material:e.Cesium.Color.RED.withAlpha(.6)},polyline:{positions:new e.Cesium.CallbackProperty(function(){if(e.positions.length<2)return;let i=[],r=[],a=e.positions.length;for(let y=0;y<a;y++)i.push(e.cartesianToLatlng(e.positions[y]));let n=i[0],s=i[i.length-1],o=n,l=[(s[0]-n[0])/4+n[0],(s[1]-n[1])/8+n[1]],h=[(n[0]+s[0])/2,n[1]],c=[(s[0]-n[0])*3/4+n[0],-(s[1]-n[1])/8+n[1]],u=[s[0],n[1]],p=[s[0],(n[1]+s[1])/2],g=[(s[0]-n[0])*3/4+n[0],(s[1]-n[1])*3/8+n[1]],v=[(n[0]+s[0])/2,(n[1]+s[1])/2],d=[(s[0]-n[0])/4+n[0],(s[1]-n[1])*5/8+n[1]],w=[n[0],(n[1]+s[1])/2],m=[n[0],s[1]],C=e.getBezierPoints([o,l,h,c,u]),f=e.getBezierPoints([p,g,v,d,w]);return r=C.concat(f),r.push(e.LatlngTocartesian(o)),r.push(e.LatlngTocartesian(m)),r},!1),show:!0,material:e.Cesium.Color.YELLOW,width:5,clampToGround:!0}});return e.entitiesCurveFlag.push(t),t}cartesianToLatlng(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return[r,i]}LatlngTocartesian(e){return this.Cesium.Cartesian3.fromDegrees(e[0],e[1])}clearPoint(){this.DrawEndEvent.raiseEvent(this.CurveFlagLast,[this.CurveFlagData[0],this.CurveFlagData[this.CurveFlagData.length-1]],this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesCurveFlag.length;e++)this.viewer.entities.remove(this.entitiesCurveFlag[e]);this.identificationPoint=null,this.CurveFlag=null,this.CurveFlagLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesCurveFlag=[],this.CurveFlagData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}getBezierPoints(e){let t=this;if(e.length<=2)return e;{let i=[],r=e.length-1;for(let a=0;a<=1;a+=.01){let[n,s]=[0,0];for(let o=0;o<=r;o++){let l=t.getBinomialFactor(r,o),h=Math.pow(a,o),c=Math.pow(1-a,r-o);n+=l*h*c*e[o][0],s+=l*h*c*e[o][1]}i.push(t.LatlngTocartesian([n,s]))}return i.push(t.LatlngTocartesian(e[r])),i}}getBinomialFactor(e,t){return this.getFactorial(e)/(this.getFactorial(t)*this.getFactorial(e-t))}getFactorial(e){let t=1;switch(e){case e<=1:t=1;break;case e===2:t=2;break;case e===3:t=6;break;case e===24:t=24;break;case e===5:t=120;break;default:for(let i=1;i<=e;i++)t*=i;break}return t}}class ht{constructor(e){this.viewer=e.viewer,this.Cesium=e.Cesium,this.identificationPoint=null,this.StraightArrow=null,this.StraightArrowLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesStraightArrow=[],this.StraightArrowData=null,this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event}getData(){return this.StraightArrowData}computePosition(e){for(var t=this,i=e.length,r=e[0],a=e[i-1],n=t.cartesianToLatlng(r),s=t.cartesianToLatlng(a),o=[],l=t.fineArrow([n[0],n[1]],[s[0],s[1]]),h=0;h<l.length;h++){var c=new t.Cesium.Cartesian3(l[h].x,l[h].y,l[h].z);o.push(c)}return t.StraightArrowData=[n,s],new t.Cesium.PolygonHierarchy(o)}addload(e){var t=this;if(e.length<2)return null;for(var i=e.length,r=e[0],a=e[i-1],n=[],s=t.fineArrow([r[0],r[1]],[a[0],a[1]]),o=0;o<s.length;o++){var l=new t.Cesium.Cartesian3(s[o].x,s[o].y,s[o].z);n.push(l)}var h=t.viewer.entities.add({Type:"DrawSharpStraightArrow",Position:e,id:e.id||t.objId,polygon:{hierarchy:new t.Cesium.PolygonHierarchy(n),show:!0,fill:!0,clampToGround:!0,material:t.Cesium.Color.RED.withAlpha(.6)}});return h}startCreate(e){this.drawType=e;var t=this;this.handler=new this.Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);t.positions.length==0&&(t.positions.push(r.clone()),t.identificationPoint=t.createPoint(r),t.positions.push(r)),t.StraightArrow||t.createPoint(r)},t.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<2)){var r=t.getCatesian3FromPX(i.endPosition);t.Cesium.defined(t.StraightArrow)||(t.StraightArrow=t.createStraightArrow()),t.identificationPoint.position.setValue(r),t.StraightArrow&&(t.positions.pop(),t.positions.push(r))}},t.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){if(t.StraightArrow){var r=t.getCatesian3FromPX(i.position);t.positions.pop(),t.positions.push(r),t.StraightArrowData=t.positions.concat(),t.viewer.entities.remove(t.StraightArrow),t.StraightArrow=null,t.positions=[],t.identificationPoint.position.setValue(r);for(var a=[],n=0;n<t.StraightArrowData.length;n++){var s=t.cartesianToLatlng(t.StraightArrowData[n]);a.push(s)}t.StraightArrowData=a;var o=t.addload(t.StraightArrowData);t.entitiesStraightArrow.push(o),t.StraightArrowLast=o,t.clearPoint(),t.destroy()}},t.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createStraightArrow(){var e=this,t=e.viewer.entities.add({polygon:{hierarchy:new e.Cesium.CallbackProperty(function(){for(var i=e.positions.length,r=e.positions[0],a=e.positions[i-1],n=e.cartesianToLatlng(r),s=e.cartesianToLatlng(a),o=[],l=e.fineArrow([n[0],n[1]],[s[0],s[1]]),h=0;h<l.length;h++){var c=new e.Cesium.Cartesian3(l[h].x,l[h].y,l[h].z);o.push(c)}return new e.Cesium.PolygonHierarchy(o)},!1),show:!0,fill:!0,clampToGround:!0,material:e.Cesium.Color.RED.withAlpha(.6)}});return e.entitiesStraightArrow.push(t),t}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.YELLOW}});return t.entitiesPoint.push(i),i}cartesianToLatlng(e){var t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude);return[r,i]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clearPoint(){this.DrawEndEvent.raiseEvent(this.StraightArrowLast,this.StraightArrowData,this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesStraightArrow.length;e++)this.viewer.entities.remove(this.entitiesStraightArrow[e]);this.identificationPoint=null,this.StraightArrow=null,this.StraightArrowLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesStraightArrow=[],this.StraightArrowData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}fineArrowDefualParam(){return{tailWidthFactor:.15,neckWidthFactor:.245,headWidthFactor:.25,headAngle:Math.PI/8.5,neckAngle:Math.PI/13}}fineArrow(e,t){var i=this;if(e.length<2||t.length<2)return;let r=i.fineArrowDefualParam().tailWidthFactor,a=i.fineArrowDefualParam().neckWidthFactor,n=i.fineArrowDefualParam().headWidthFactor,s=i.fineArrowDefualParam().headAngle,o=i.fineArrowDefualParam().neckAngle;var l=[];l[0]=e,l[1]=t;var h=l[0],c=l[1],u=i.getBaseLength(l),p=u*r,g=u*a,v=u*n,d=i.getThirdPoint(c,h,Math.PI/2,p,!0),w=i.getThirdPoint(c,h,Math.PI/2,p,!1),m=i.getThirdPoint(h,c,s,v,!1),C=i.getThirdPoint(h,c,s,v,!0),f=i.getThirdPoint(h,c,o,g,!1),y=i.getThirdPoint(h,c,o,g,!0),D=[];return D.push(d[0],d[1],f[0],f[1],m[0],m[1],c[0],c[1],C[0],C[1],y[0],y[1],w[0],w[1],h[0],h[1]),i.Cesium.Cartesian3.fromDegreesArray(D)}getBaseLength(e){return Math.pow(this.wholeDistance(e),.99)}wholeDistance(e){for(var t=0,i=0;i<e.length-1;i++)t+=this.distance(e[i],e[i+1]);return t}distance(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}getThirdPoint(e,t,i,r,a){var n=this.getAzimuth(e,t),s=a?n+i:n-i,o=r*Math.cos(s),l=r*Math.sin(s);return[t[0]+o,t[1]+l]}getAzimuth(e,t){var i,r=Math.asin(Math.abs(t[1]-e[1])/this.distance(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=r+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=2*Math.PI-r:t[1]<e[1]&&t[0]<e[0]?i=r:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-r),i}}class ct{constructor(e){S(this,"getAttackArrowBodyPoints",function(e,t,i,r){for(var a=this,n=a.wholeDistance(e),s=a.getBaseLength(e),o=s*r,l=a.distance(t,i),h=(o-l)/2,c=0,u=[],p=[],g=1;g<e.length-1;g++){var v=a.getAngleOfThreePoints(e[g-1],e[g],e[g+1])/2;c+=a.distance(e[g-1],e[g]);var d=(o/2-c/n*h)/Math.sin(v),w=a.getThirdPoint(e[g-1],e[g],Math.PI-v,d,!0),m=a.getThirdPoint(e[g-1],e[g],v,d,!1);u.push(w),p.push(m)}return u.concat(p)});S(this,"getQBSplinePoints",function(e){if(e.length<=2)return e;var t=2,i=[],r=e.length-t-1,a=0;i.push(e[0]);for(var n=0;r>=n;n++)for(var s=0;1>=s;s+=.05){for(var o=a=0,l=0;t>=l;l++){var h=this.getQuadricBSplineFactor(l,s);o+=h*e[n+l][0],a+=h*e[n+l][1]}i.push([o,a])}return i.push(e[e.length-1]),i});S(this,"getQuadricBSplineFactor",function(e,t){return e==0?Math.pow(t-1,2)/2:e==1?(-2*Math.pow(t,2)+2*t+1)/2:e==2?Math.pow(t,2)/2:0});S(this,"array2Dto1D",function(e){var t=[];return e.forEach(function(i){t.push(i[0]),t.push(i[1])}),t});this.objId=+(new Date().getTime()+""+Number(Math.random()*1e3).toFixed(0)),this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event,this.viewer=e.viewer,this.Cesium=e.Cesium,this.identificationPoint=null,this.attackArrow=null,this.attackArrowLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesattackArrow=[],this.attackArrowData=null}getData(){return this.attackArrowData}addload(e){var t=this;if(e.length<3)return null;var i=t.fineArrow(e),r=i.polygonalPoint;r.splice(r.length-2,1);var a=t.viewer.entities.add({Type:"DrawHorizontalArrow",Position:e,id:e.id||t.objId,polygon:{hierarchy:new t.Cesium.PolygonHierarchy(r),show:!0,fill:!0,clampToGround:!0,material:t.Cesium.Color.RED.withAlpha(.6)}});return a}computePosition(e){let t=this;for(var i=[],r=0;r<e.length;r++){var a=t.cartesianToLatlng(e[r]);i.push(a)}t.attackArrowData=i;var n=t.fineArrow(i),s=n.polygonalPoint;return s.splice(s.length-2,1),new t.Cesium.PolygonHierarchy(s)}startCreate(e){this.drawType=e;var t=this;this.handler=new t.Cesium.ScreenSpaceEventHandler(t.viewer.scene.canvas),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);t.positions.length==0&&(t.identificationPoint=t.createPoint(r),t.createPoint(r)),t.positions.length==1&&(t.positions.push(r.clone()),t.createPoint(r)),t.positions.push(r)},t.Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(!(t.positions.length<3)){var r=t.getCatesian3FromPX(i.endPosition);t.Cesium.defined(t.attackArrow)||(t.attackArrow=t.createAttackArrow()),t.identificationPoint.position.setValue(r),t.attackArrow&&(t.positions.pop(),t.positions.push(r))}},t.Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){var r=t.getCatesian3FromPX(i.position);t.positions.pop(),t.attackArrowData=t.positions.concat(),t.viewer.entities.remove(t.attackArrow),t.attackArrow=null,t.positions=[],t.identificationPoint.position.setValue(r);let a=[];for(var n=0;n<t.attackArrowData.length;n++){var s=t.cartesianToLatlng(t.attackArrowData[n]);a.push(s)}t.attackArrowData=a;var o=t.addload(a);t.entitiesattackArrow.push(o),t.attackArrowLast=o,t.clearPoint(),t.destroy()},t.Cesium.ScreenSpaceEventType.RIGHT_CLICK)}createAttackArrow(){var e=this,t=e.viewer.entities.add({polygon:{hierarchy:new e.Cesium.CallbackProperty(function(){for(var i=[],r=0;r<e.positions.length;r++){var a=e.cartesianToLatlng(e.positions[r]);i.push(a)}var n=e.fineArrow(i),s=n.polygonalPoint;return s.splice(s.length-2,1),new e.Cesium.PolygonHierarchy(s)},!1),show:!0,fill:!0,clampToGround:!0,material:e.Cesium.Color.RED.withAlpha(.6)}});return e.entitiesattackArrow.push(t),t}createPoint(e){var t=this,i=this.viewer.entities.add({position:e,point:{pixelSize:10,color:t.Cesium.Color.RED}});return i.objId=this.objId,t.entitiesPoint.push(i),i}cartesianToLatlng(e){let t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=this.Cesium.Math.toDegrees(t.latitude),r=this.Cesium.Math.toDegrees(t.longitude),a=t.height;return[r,i,a]}destroy(){this.handler&&(this.handler.destroy(),this.handler=null)}clearPoint(){this.DrawEndEvent.raiseEvent(this.attackArrowLast,this.attackArrowData,this.drawType);for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);this.entitiesPoint=[]}clear(){for(var e=0;e<this.entitiesPoint.length;e++)this.viewer.entities.remove(this.entitiesPoint[e]);for(var e=0;e<this.entitiesattackArrow.length;e++)this.viewer.entities.remove(this.entitiesattackArrow[e]);this.identificationPoint=null,this.attackArrow=null,this.attackArrowLast=null,this.positions=[],this.entitiesPoint=[],this.entitiesattackArrow=[],this.attackArrowData=null}getCatesian3FromPX(e){var t,i=this.viewer.camera.getPickRay(e);return i?(t=this.viewer.scene.globe.pick(i,this.viewer.scene),t):null}fineArrowDefualParam(){return{headHeightFactor:.18,headWidthFactor:.3,neckHeightFactor:.85,neckWidthFactor:.15,tailWidthFactor:.1,headTailFactor:.8,swallowTailFactor:1}}fineArrow(e){var t=this;e=t.dereplication(e);let i=t.fineArrowDefualParam().tailWidthFactor,r=t.fineArrowDefualParam().swallowTailFactor,a=t.fineArrowDefualParam().swallowTailPnt;var n={controlPoint:null,polygonalPoint:null};n.controlPoint=e;var s=e.length;if(!(2>s)){if(e.length==2)return n.polygonalPoint=e,n;var o=e,l=o[0],h=o[1];t.isClockWise(o[0],o[1],o[2])&&(l=o[1],h=o[0]);var c=t.mid(l,h),u=[c].concat(o.slice(2)),p=t.getAttackArrowHeadPoints(u,l,h,t.fineArrowDefualParam()),g=p[0],v=p[4],d=t.distance(l,h),w=t.getBaseLength(u),m=w*i*r;a=t.getThirdPoint(u[1],u[0],0,m,!0);var C=d/w,f=t.getAttackArrowBodyPoints(u,g,v,C),s=f.length,y=[l].concat(f.slice(0,s/2));y.push(g);var D=[h].concat(f.slice(s/2,s)),E=[];D.push(v),y=t.getQBSplinePoints(y),D=t.getQBSplinePoints(D),E=t.array2Dto1D(y.concat(p,D.reverse(),[a,y[0]])),n.polygonalPoint=t.Cesium.Cartesian3.fromDegreesArray(E)}return n}getArrowBodyPoints(e,t,i,r){for(var a=this,n=a.wholeDistance(e),s=a.getBaseLength(e),o=s*r,l=a.distance(t,i),h=(o-l)/2,c=0,u=[],p=[],g=1;g<e.length-1;g++){var v=a.getAngleOfThreePoints(e[g-1],e[g],e[g+1])/2;c+=a.distance(e[g-1],e[g]);var d=(o/2-c/n*h)/Math.sin(v),w=a.getThirdPoint(e[g-1],e[g],Math.PI-v,d,!0),m=a.getThirdPoint(e[g-1],e[g],v,d,!1);u.push(w),p.push(m)}return u.concat(p)}getAttackArrowHeadPoints(e,t,i,r){var a=this;let n=r.headHeightFactor,s=r.headTailFactor,o=r.headWidthFactor,l=r.neckWidthFactor,h=r.neckHeightFactor;var c=a.getBaseLength(e),u=c*n,p=e[e.length-1];c=a.distance(p,e[e.length-2]);var g=a.distance(t,i);u>g*s&&(u=g*s);var v=u*o,d=u*l;u=u>c?c:u;var w=u*h,m=a.getThirdPoint(e[e.length-2],p,0,u,!0),C=a.getThirdPoint(e[e.length-2],p,0,w,!0),f=a.getThirdPoint(p,m,Math.PI/2,v,!1),y=a.getThirdPoint(p,m,Math.PI/2,v,!0),D=a.getThirdPoint(p,C,Math.PI/2,d,!1),E=a.getThirdPoint(p,C,Math.PI/2,d,!0);return[D,f,p,y,E]}getAngleOfThreePoints(e,t,i){var r=this.getAzimuth(t,e)-this.getAzimuth(t,i);return 0>r?r+Math.PI*2:r}dereplication(e){var t=e[e.length-1],i=!1,r=[];return r=e.filter(function(a){if(a[0]!=t[0]&&a[1]!=t[1])return a;i=!0}),i&&r.push(t),r}getBaseLength(e){return Math.pow(this.wholeDistance(e),.99)}wholeDistance(e){for(var t=0,i=0;i<e.length-1;i++)t+=this.distance(e[i],e[i+1]);return t}distance(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}getThirdPoint(e,t,i,r,a){var n=this.getAzimuth(e,t),s=a?n+i:n-i,o=r*Math.cos(s),l=r*Math.sin(s);return[t[0]+o,t[1]+l]}getAzimuth(e,t){var i,r=Math.asin(Math.abs(t[1]-e[1])/this.distance(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=r+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=2*Math.PI-r:t[1]<e[1]&&t[0]<e[0]?i=r:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-r),i}isClockWise(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])}mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}}let M={DrawSwallowArrow:Y,DrawCircle:K,DrawCurve:U,DrawPincerArrow:j,DrawPoint:q,DrawPolygon:Z,DrawPolyline:Q,DrawRectangle:J,DrawStraightArrow:tt,GatheringPlace:et,DrawSector:it,DrawClosedCurve:rt,DrawArc:nt,DrawLune:at,RectFlag:st,TriangleFlag:ot,CurveFlag:lt,DrawSharpStraightArrow:ht,DrawHorizontalArrow:ct};class ut{constructor(e){this.viewer=e,this.DrawExample="",this.midVertexEntities=[],this.initEventHandler()}initEventHandler(){this.eventHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.EditEndEvent=new Cesium.Event,this.EditEndEntity=new Cesium.Event}activate(){this.deactivate(),this.initLeftClickEventHandler()}deactivate(){this.DrawExample="",this.eventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this.unRegisterEvents(),this.clearAllEditVertex()}clearAllEditVertex(){this.clearEditVertex(),this.clearMidVertex()}initLeftClickEventHandler(){this.eventHandler.setInputAction(e=>{let t=this.viewer.scene.pick(e.position);if(!t||!t.id){this.handleEditEntity();return}!t.id||!t.id.Type||this.editEntity&&this.editEntity.id==t.id.id||this.editEntity||(this.handleEditEntity(),this.handlePickEditEntity(t.id))},Cesium.ScreenSpaceEventType.LEFT_CLICK)}handleEditEntity(){this.unRegisterEvents(),this.clearAllEditVertex();let e=this.editEntity;e&&(this.closeEntityEditMode(),this.editEntity=void 0,this.isEdited&&(this.EditEndEvent.raiseEvent(e),this.isEdited=!1,this.isEditing=!1))}handlePickEditEntity(e){["DrawSwallowArrow","DrawCircle","DrawCurve","DrawPincerArrow","DrawPoint","DrawPolygon","DrawPolyline","DrawRectangle","DrawStraightArrow","GatheringPlace","DrawSector","DrawClosedCurve","DrawArc","DrawLune","DrawRectFlag","DrawTriangleFlag","DrawCurveFlag","DrawSharpStraightArrow","DrawHorizontalArrow"].indexOf(e.Type)!=-1&&(this.editEntity=e,this.EditEndEntity.raiseEvent(this.editEntity),this.isEditing=!1,this.isEdited=!1,this.editPositions=this.getEditEntityPositions(),this.EditMoveCenterPositoin=this.getCenterPosition(),this.openEntityEditModel(),this.clearAllEditVertex(),this.unRegisterEvents(),this.createEditVertex(),this.createMidVertex(),this.registerEvents())}openEntityEditModel(){if(this.DrawExample!="")switch(this.editEntity.Type){case"DrawSwallowArrow":this.editEntity.polygon.hierarchy=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions),!1);break;case"DrawCircle":this.editEntity.position=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions).position,!1),this.editEntity.ellipse.semiMinorAxis=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions).r,!1),this.editEntity.ellipse.semiMajorAxis=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions).r,!1);break;case"DrawCurve":this.editEntity.polyline.positions=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions),!1);break;case"DrawPincerArrow":this.editEntity.polygon.hierarchy=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions),!1);break;case"DrawPoint":this.editEntity.position=new Cesium.CallbackProperty(e=>this.editPositions[0],!1);break;case"DrawPolygon":this.editEntity.polygon.hierarchy=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions),!1);break;case"DrawPolyline":this.editEntity.polyline.positions=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions),!1);break;case"DrawRectangle":this.editEntity.rectangle.coordinates=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions),!1);break;case"DrawStraightArrow":this.editEntity.polygon.hierarchy=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions),!1);break;case"GatheringPlace":this.editEntity.polygon.hierarchy=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions),!1);break;case"DrawSector":this.editEntity.polygon.hierarchy=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions),!1);break;case"DrawClosedCurve":this.editEntity.polygon.hierarchy=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions).PolygonHierarchy,!1),this.editEntity.polyline.positions=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions).pList,!1);break;case"DrawArc":this.editEntity.polyline.positions=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions),!1);break;case"DrawLune":this.editEntity.polygon.hierarchy=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions),!1);break;case"DrawRectFlag":this.editEntity.polygon.hierarchy=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions)[0],!1),this.editEntity.polyline.positions=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions)[1],!1);break;case"DrawTriangleFlag":this.editEntity.polygon.hierarchy=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions)[0],!1),this.editEntity.polyline.positions=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions)[1],!1);break;case"DrawCurveFlag":this.editEntity.polygon.hierarchy=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions)[0],!1),this.editEntity.polyline.positions=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions)[1],!1);break;case"DrawSharpStraightArrow":this.editEntity.polygon.hierarchy=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions),!1);break;case"DrawHorizontalArrow":this.editEntity.polygon.hierarchy=new Cesium.CallbackProperty(e=>this.DrawExample.computePosition(this.editPositions),!1);break}}closeEntityEditMode(){if(this.DrawExample=="")return;let e="";switch(this.editEntity.Type){case"DrawSwallowArrow":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polygon.hierarchy=e,this.editEntity.Position=this.DrawExample.getData();break;case"DrawCircle":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.position=e.position,this.editEntity.ellipse.semiMinorAxis=e.r,this.editEntity.ellipse.semiMajorAxis=e.r,this.editEntity.Position=this.DrawExample.getData();break;case"DrawCurve":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polyline.positions=e,this.editEntity.Position=this.DrawExample.getData();break;case"DrawPincerArrow":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polygon.hierarchy=e,this.editEntity.Position=this.DrawExample.getData();break;case"DrawPoint":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.position=e,this.editEntity.Position=this.DrawExample.getData();break;case"DrawPolygon":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polygon.hierarchy=e,this.editEntity.Position=this.DrawExample.getData();break;case"DrawPolyline":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polyline.positions=e,this.editEntity.Position=this.DrawExample.getData();break;case"DrawRectangle":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.rectangle.coordinates=e,this.editEntity.Position=this.DrawExample.getData();break;case"DrawStraightArrow":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polygon.hierarchy=e,this.editEntity.Position=this.DrawExample.getData();break;case"GatheringPlace":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polygon.hierarchy=e,this.editEntity.Position=this.DrawExample.getData();break;case"DrawSector":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polygon.hierarchy=e,this.editEntity.Position=this.DrawExample.getData();break;case"DrawClosedCurve":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polygon.hierarchy=e.PolygonHierarchy,this.editEntity.polyline.positions=e.pList,this.editEntity.Position=this.DrawExample.getData();break;case"DrawArc":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polyline.positions=e,this.editEntity.Position=this.DrawExample.getData();break;case"DrawLune":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polygon.hierarchy=e,this.editEntity.Position=this.DrawExample.getData();break;case"DrawRectFlag":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polygon.hierarchy=e[0],this.editEntity.polyline.positions=e[1],this.editEntity.Position=this.DrawExample.getData();break;case"DrawTriangleFlag":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polygon.hierarchy=e[0],this.editEntity.polyline.positions=e[1],this.editEntity.Position=this.DrawExample.getData();break;case"DrawCurveFlag":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polygon.hierarchy=e[0],this.editEntity.polyline.positions=e[1],this.editEntity.Position=this.DrawExample.getData();break;case"DrawSharpStraightArrow":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polygon.hierarchy=e,this.editEntity.Position=this.DrawExample.getData();break;case"DrawHorizontalArrow":e=this.DrawExample.computePosition(this.editPositions),this.editEntity.polygon.hierarchy=e,this.editEntity.Position=this.DrawExample.getData();break}}getEditEntityPositions(){let e=this.editEntity.Position,t=[];switch(this.editEntity.Type){case"DrawSwallowArrow":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawCircle":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawCurve":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawPincerArrow":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawPoint":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawPolygon":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawPolyline":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawRectangle":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawStraightArrow":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"GatheringPlace":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawSector":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawClosedCurve":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawArc":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawLune":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawRectFlag":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawTriangleFlag":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawCurveFlag":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawSharpStraightArrow":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t;case"DrawHorizontalArrow":for(let i=0;i<e.length;i++)t.push(this.LatlngTocartesian(e[i]));return t}}registerEvents(){this.initLeftDownEventHandler(),this.initMouseMoveEventHandler(),this.initLeftUpEventHandler()}unRegisterEvents(){this.eventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOWN),this.eventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_UP),this.eventHandler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE)}initLeftDownEventHandler(){this.eventHandler.setInputAction(e=>{let t=this.viewer.scene.pick(e.position);if(!(!t||!t.id||!t.id.type))if(t.id.type=="EditVertex"||t.id.type=="EditMove")this.isEditing=!0,this.viewer.scene.screenSpaceCameraController.enableRotate=!1,this.viewer.enableCursorStyle=!1,this.viewer._element.style.cursor="",document.body.style.cursor="move",this.editVertext=t.id,this.editVertext.show=!1,this.clearMidVertex();else if(t.id.type=="EditMidVertex")this.editPositions.splice(t.id.vertexIndex,0,t.id.position._value),this.clearAllEditVertex(),this.createEditVertex(),this.createMidVertex(),this.isEdited=!0;else return},Cesium.ScreenSpaceEventType.LEFT_DOWN)}initLeftUpEventHandler(){this.eventHandler.setInputAction(e=>{this.isEditing&&(this.viewer.enableCursorStyle=!0,document.body.style.cursor="default",this.viewer.scene.screenSpaceCameraController.enableRotate=!0,this.editVertext.show=!0,this.isEditing=!1,this.clearMidVertex(),this.createMidVertex())},Cesium.ScreenSpaceEventType.LEFT_UP)}initMouseMoveEventHandler(){this.eventHandler.setInputAction(e=>{var t=e.endPosition,i=this.viewer.scene.camera.getPickRay(t),r=this.viewer.scene.globe.pick(i,this.viewer.scene);if(r&&this.isEditing){if(this.editVertext.type=="EditMove"){let a=this.EditMoveCenterPositoin;if(!a)return;this.moveEntityByOffset(a,r)}else(this.editVertext.type=="EditVertex"||this.editVertext.type=="EditMidVertex")&&(this.editPositions[this.editVertext.vertexIndex]=r);this.isEdited=!0,this.EditMoveCenterPositoin=this.getCenterPosition()}},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}getCenterPosition(){let e=[],t=0;if(this.editEntity.Type=="DrawCircle"||this.editEntity.Type=="DrawPoint"||this.editEntity.Type=="DrawSector")return this.editPositions[0];this.editPositions.forEach(o=>{const l=this.cartesian3ToPoint3D(o);e.push([l.x,l.y]),t<l.z&&(t=l.z)});let i=H(e),r=$(i),a=B(r),s=W(a).geometry.coordinates;return Cesium.Cartesian3.fromDegrees(s[0],s[1],t)}moveEntityByOffset(e,t){let i=this.cartesian3ToPoint3D(e),r=this.cartesian3ToPoint3D(t),a=r.x-i.x,n=r.y-i.y,s;for(let o=0;o<this.editPositions.length;o++)s=this.cartesian3ToPoint3D(this.editPositions[o]),s.x+=a,s.y+=n,this.editPositions[o]=Cesium.Cartesian3.fromDegrees(s.x,s.y,s.z)}createEditVertex(){this.vertexEntities=[],this.editPositions.forEach((e,t)=>{const i=this.viewer.entities.add({position:new Cesium.CallbackProperty(r=>this.editPositions[t],!1),type:"EditVertex",vertexIndex:t,point:{color:Cesium.Color.DARKBLUE.withAlpha(.9),pixelSize:10,outlineColor:Cesium.Color.YELLOW.withAlpha(.9),outlineWidth:5,disableDepthTestDistance:2e3,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}});this.vertexEntities.push(i)}),this.editEntity.Type=="DrawCircle"&&(this.vertexEntities[0].show=!1),this.editPositions.length!=1&&this.createEditMoveCenterEntity()}createEditMoveCenterEntity(){this.EditMoveCenterEntity=this.viewer.entities.add({position:new Cesium.CallbackProperty(e=>this.EditMoveCenterPositoin,!1),type:"EditMove",point:{color:Cesium.Color.RED.withAlpha(.9),pixelSize:10,outlineColor:Cesium.Color.WHITE.withAlpha(.9),outlineWidth:3,disableDepthTestDistance:2e3}})}clearEditVertex(){this.vertexEntities&&this.vertexEntities.forEach(e=>{this.viewer.entities.remove(e)}),this.vertexEntities=[],this.viewer.entities.remove(this.EditMoveCenterEntity)}createMidVertex(){if(!(this.editEntity.Type=="DrawCircle"||this.editEntity.Type=="DrawPincerArrow"||this.editEntity.Type=="DrawRectangle"||this.editEntity.Type=="DrawStraightArrow"||this.editEntity.Type=="GatheringPlace"||this.editEntity.Type=="DrawSector"||this.editEntity.Type=="DrawArc"||this.editEntity.Type=="DrawLune"||this.editEntity.Type=="DrawRectFlag"||this.editEntity.Type=="DrawTriangleFlag"||this.editEntity.Type=="DrawCurveFlag"||this.editEntity.Type=="DrawSharpStraightArrow")){this.midVertexEntities=[];for(let e=0;e<this.editPositions.length;e++){const t=this.editPositions[e],i=this.editPositions[e+1];let r=this.midPosition(t,i);const a=this.viewer.entities.add({position:r,type:"EditMidVertex",vertexIndex:e+1,point:{color:Cesium.Color.LIMEGREEN.withAlpha(.9),pixelSize:10,outlineColor:Cesium.Color.YELLOW.withAlpha(.9),outlineWidth:3,disableDepthTestDistance:2e3}});this.midVertexEntities.push(a)}}}clearMidVertex(){this.midVertexEntities&&this.midVertexEntities.forEach(e=>{this.viewer.entities.remove(e)}),this.midVertexEntities=[]}cartesian3ToPoint3D(e){const t=Cesium.Cartographic.fromCartesian(e),i=Cesium.Math.toDegrees(t.longitude),r=Cesium.Math.toDegrees(t.latitude);return{x:i,y:r,z:t.height}}midPosition(e,t){if(!e||!t)return null;let i=this.cartesian3ToPoint3D(e),r=this.cartesian3ToPoint3D(t),a={x:(i.x+r.x)/2,y:(i.y+r.y)/2,z:(i.z+r.z)/2};return Cesium.Cartesian3.fromDegrees(a.x,a.y,a.z)}cartesianToLatlng(e){let t=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),i=new Cesium.Math.toDegrees(t.latitude),r=new Cesium.Math.toDegrees(t.longitude);return t.height,[r,i]}LatlngTocartesian(e){return new Cesium.Cartesian3.fromDegrees(e[0],e[1])}}let F={init(P){this.viewer=P.viewer,this.cesium=P.Cesium,this.Draw="",this.edit=new ut(this.viewer),this.edit.activate(),this.edit.EditEndEntity.addEventListener(e=>{e.Type&&(this.handleFirstPosition(e.Type),this.edit.DrawExample=this.Draw),this.result=e})},drawActivate(P){return this.handleFirstPosition(P),this.Draw.startCreate(P),this.edit.activate(),this.Draw},editActivate(){return this.edit},handleFirstPosition(P){switch(P){case"DrawSwallowArrow":this.Draw=new M.DrawSwallowArrow({viewer:this.viewer,Cesium:this.cesium});break;case"DrawCircle":this.Draw=new M.DrawCircle({viewer:this.viewer,Cesium:this.cesium});break;case"DrawCurve":this.Draw=new M.DrawCurve({viewer:this.viewer,Cesium:this.cesium});break;case"DrawPincerArrow":this.Draw=new M.DrawPincerArrow({viewer:this.viewer,Cesium:this.cesium});break;case"DrawPoint":this.Draw=new M.DrawPoint({viewer:this.viewer,Cesium:this.cesium});break;case"DrawPolygon":this.Draw=new M.DrawPolygon({viewer:this.viewer,Cesium:this.cesium});break;case"DrawPolyline":this.Draw=new M.DrawPolyline({viewer:this.viewer,Cesium:this.cesium});break;case"DrawRectangle":this.Draw=new M.DrawRectangle({viewer:this.viewer,Cesium:this.cesium});break;case"DrawStraightArrow":this.Draw=new M.DrawStraightArrow({viewer:this.viewer,Cesium:this.cesium});break;case"GatheringPlace":this.Draw=new M.GatheringPlace({viewer:this.viewer,Cesium:this.cesium});break;case"DrawSector":this.Draw=new M.DrawSector({viewer:this.viewer,Cesium:this.cesium});break;case"DrawClosedCurve":this.Draw=new M.DrawClosedCurve({viewer:this.viewer,Cesium:this.cesium});break;case"DrawArc":this.Draw=new M.DrawArc({viewer:this.viewer,Cesium:this.cesium});break;case"DrawLune":this.Draw=new M.DrawLune({viewer:this.viewer,Cesium:this.cesium});break;case"RectFlag":this.Draw=new M.RectFlag({viewer:this.viewer,Cesium:this.cesium});break;case"TriangleFlag":this.Draw=new M.TriangleFlag({viewer:this.viewer,Cesium:this.cesium});break;case"CurveFlag":this.Draw=new M.CurveFlag({viewer:this.viewer,Cesium:this.cesium});break;case"DrawSharpStraightArrow":this.Draw=new M.DrawSharpStraightArrow({viewer:this.viewer,Cesium:this.cesium});break;case"DrawHorizontalArrow":this.Draw=new M.DrawHorizontalArrow({viewer:this.viewer,Cesium:this.cesium});break}},addEntity(P){if(this.handleFirstPosition(P.type),this.Draw){let e=this.Draw.addload(P.position);return e._id=P.id,e}}};const gt={class:"toolPane"},pt={__name:"index",setup(P){O(async()=>{F.init({viewer,Cesium}),t()});function e(i){F.drawActivate(i).DrawEndEvent.addEventListener((a,n,s)=>{})}function t(){F.editActivate().EditEndEvent.addEventListener(r=>{r._Position,r._id})}return(i,r)=>{const a=X("el-button");return N(),z(V,null,[T(x),G("div",gt,[T(a,{onClick:r[0]||(r[0]=n=>e("DrawPoint"))},{default:A(()=>[L("点")]),_:1}),T(a,{onClick:r[1]||(r[1]=n=>e("DrawCircle"))},{default:A(()=>[L("圆")]),_:1}),T(a,{onClick:r[2]||(r[2]=n=>e("DrawCurve"))},{default:A(()=>[L("曲线")]),_:1}),T(a,{onClick:r[3]||(r[3]=n=>e("DrawRectangle"))},{default:A(()=>[L("矩形")]),_:1}),T(a,{onClick:r[4]||(r[4]=n=>e("DrawPolyline"))},{default:A(()=>[L("折线")]),_:1}),T(a,{onClick:r[5]||(r[5]=n=>e("DrawPolygon"))},{default:A(()=>[L("多边形")]),_:1}),T(a,{onClick:r[6]||(r[6]=n=>e("DrawStraightArrow"))},{default:A(()=>[L("直线箭头")]),_:1}),T(a,{onClick:r[7]||(r[7]=n=>e("DrawSwallowArrow"))},{default:A(()=>[L("绘制攻击箭头")]),_:1}),T(a,{onClick:r[8]||(r[8]=n=>e("DrawPincerArrow"))},{default:A(()=>[L("绘制钳击箭头")]),_:1}),T(a,{onClick:r[9]||(r[9]=n=>e("GatheringPlace"))},{default:A(()=>[L("绘制集结地")]),_:1}),T(a,{onClick:r[10]||(r[10]=n=>e("DrawSector"))},{default:A(()=>[L("绘制扇形")]),_:1}),T(a,{onClick:r[11]||(r[11]=n=>e("DrawClosedCurve"))},{default:A(()=>[L("绘制闭合曲面")]),_:1}),T(a,{onClick:r[12]||(r[12]=n=>e("DrawArc"))},{default:A(()=>[L("绘制弓形")]),_:1}),T(a,{onClick:r[13]||(r[13]=n=>e("DrawLune"))},{default:A(()=>[L("绘制弓形面")]),_:1}),T(a,{onClick:r[14]||(r[14]=n=>e("RectFlag"))},{default:A(()=>[L("绘制矩形旗帜")]),_:1}),T(a,{onClick:r[15]||(r[15]=n=>e("TriangleFlag"))},{default:A(()=>[L("绘制三角形旗帜")]),_:1}),T(a,{onClick:r[16]||(r[16]=n=>e("CurveFlag"))},{default:A(()=>[L("绘制曲面旗帜")]),_:1}),T(a,{onClick:r[17]||(r[17]=n=>e("DrawSharpStraightArrow"))},{default:A(()=>[L("单尖直箭头")]),_:1}),T(a,{onClick:r[18]||(r[18]=n=>e("DrawHorizontalArrow"))},{default:A(()=>[L("平尾箭头")]),_:1})])],64)}}},Pt=_(pt,[["__scopeId","data-v-061b3554"]]);export{Pt as default};
